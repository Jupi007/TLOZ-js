var e=Object.defineProperty,t=(t,a,l)=>(((t,a,l)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l})(t,"symbol"!=typeof a?a+"":a,l),l);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var a,l,i,s,n,d,h,u,r,o,w,f,g,c,p,m,x,y,G,S,b,k,v;class C{constructor(){t(this,"currentFrame"),t(this,"isFirstFrame"),this.currentFrame=0,this.isFirstFrame=!0}update(e){this.currentFrame+=e}}class B extends C{constructor(e){super(),t(this,"lastState"),t(this,"lastFrameState"),t(this,"state"),t(this,"nextState"),this.lastState=null,this.lastFrameState=null,this.state=e,this.nextState=null}set(e){this.lastState=this.state,this.state=e,this.nextState=null,this.currentFrame=0,this.isFirstFrame=!0}setNextState(e){this.nextState=e}update(e){this.lastFrameState=this.state,null!==this.nextState?this.set(this.nextState):this.isFirstFrame=!1,super.update(e)}get(){return this.state}getLast(){return this.lastState}getLastFrame(){return this.lastFrameState}is(e){return this.state===e}isIn(...e){return e.some((e=>this.is(e)))}was(e){return this.lastState===e}wasIn(...e){return e.some((e=>this.was(e)))}wasLastFrame(e){return this.lastFrameState===e}wasInLastFrame(...e){return e.some((e=>this.wasLastFrame(e)))}}class P extends C{constructor(e,a){super(),t(this,"animationStepDuration"),t(this,"currentAnimationStep",1),t(this,"nbAnimationStep"),this.animationStepDuration=e,this.nbAnimationStep=a}update(e){this.currentFrame>=this.animationStepDuration?(this.currentFrame=0,this.currentAnimationStep=this.currentAnimationStep+1>this.nbAnimationStep?1:this.currentAnimationStep+1,this.isFirstFrame=!0):this.isFirstFrame=!1,super.update(e)}}class I{static load(e){let t=new Image;return t.src=e,t}}class R{static load(e,t=!1){let a=new Audio(e);return a.loop=t,a}}class O{constructor(e){t(this,"Game"),t(this,"_sprite"),t(this,"hasCollisions"),this.Game=e,this.hasCollisions=!1}get sprite(){return this._sprite}set sprite(e){this._sprite=e}}class D extends O{constructor(e){super(e),t(this,"sprites",[]),t(this,"spritesAnimation")}}class L{constructor(e){t(this,"Game"),this.Game=e}get(e){switch(e){case"passage":return new a.Passage(this.Game);case"default":return new a.Default(this.Game);case"default-dungeon":return new a.DefaultDungeon(this.Game);case"stairs":return new a.Stairs(this.Game);case"tree":return new a.Tree(this.Game);case"white-tree":return new a.WhiteTree(this.Game);case"grave":return new a.Grave(this.Game);case"wall":return new a.Wall(this.Game);case"wall-dungeon":return new a.WallDungeon(this.Game);case"red-wall":return new a.RedWall(this.Game);case"single-wall":return new a.SingleWall(this.Game);case"single-red-wall":return new a.SingleRedWall(this.Game);case"wall-t":return new a.WallTop(this.Game);case"wall-tr":return new a.WallTopRight(this.Game);case"wall-tl":return new a.WallTopLeft(this.Game);case"wall-br":return new a.WallBottomRight(this.Game);case"wall-bl":return new a.WallBottomLeft(this.Game);case"white-wall":return new a.WhiteWall(this.Game);case"white-wall-t":return new a.WhiteWallTop(this.Game);case"white-wall-tr":return new a.WhiteWallTopRight(this.Game);case"white-wall-tl":return new a.WhiteWallTopLeft(this.Game);case"white-wall-br":return new a.WhiteWallBottomRight(this.Game);case"white-wall-bl":return new a.WhiteWallBottomLeft(this.Game);case"monument-tr":return new a.MonumentTopRight(this.Game);case"monument-tl":return new a.MonumentTopLeft(this.Game);case"monument-br":return new a.MonumentBottomRight(this.Game);case"monument-bl":return new a.MonumentBottomLeft(this.Game);case"fire":return new a.Fire(this.Game);default:throw"Brick "+e+" not found"}}}!function(e){e.Passage=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/passage.png")}};e.Default=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/default.png")}};e.DefaultDungeon=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/default-dungeon.png")}};e.Stairs=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/stairs.png")}};e.Tree=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/tree.png"),this.hasCollisions=!0}};e.WhiteTree=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/white-tree.png"),this.hasCollisions=!0}};e.Grave=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/grave.png"),this.hasCollisions=!0}};e.Wall=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/wall.png"),this.hasCollisions=!0}};e.WallDungeon=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/wall-dungeon.png"),this.hasCollisions=!0}};e.RedWall=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/red-wall.png"),this.hasCollisions=!0}};e.SingleWall=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/single-wall.png"),this.hasCollisions=!0}};e.SingleRedWall=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/single-red-wall.png"),this.hasCollisions=!0}};e.WallTop=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/wall-top.png"),this.hasCollisions=!0}};e.WallTopRight=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/wall-top-right.png"),this.hasCollisions=!0}};e.WallTopLeft=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/wall-top-left.png"),this.hasCollisions=!0}};e.WallBottomRight=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/wall-bottom-right.png"),this.hasCollisions=!0}};e.WallBottomLeft=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/wall-bottom-left.png"),this.hasCollisions=!0}};e.WhiteWall=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/white-wall.png"),this.hasCollisions=!0}};e.WhiteWallTop=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/white-wall-top.png"),this.hasCollisions=!0}};e.WhiteWallTopRight=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/white-wall-top-right.png"),this.hasCollisions=!0}};e.WhiteWallTopLeft=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/white-wall-top-left.png"),this.hasCollisions=!0}};e.WhiteWallBottomRight=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/white-wall-bottom-right.png"),this.hasCollisions=!0}};e.WhiteWallBottomLeft=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/white-wall-bottom-left.png"),this.hasCollisions=!0}};e.MonumentTopRight=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/monument-top-right.png"),this.hasCollisions=!0}};e.MonumentTopLeft=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/monument-top-left.png"),this.hasCollisions=!0}};e.MonumentBottomRight=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/monument-bottom-right.png"),this.hasCollisions=!0}};e.MonumentBottomLeft=class extends O{constructor(e){super(e),this.sprite=I.load("./sprites/png/bricks/monument-bottom-left.png"),this.hasCollisions=!0}};e.Fire=class extends D{constructor(e){super(e),this.hasCollisions=!0,this.sprites[1]=I.load("./sprites/png/bricks/fire1.png"),this.sprites[2]=I.load("./sprites/png/bricks/fire2.png"),this.spritesAnimation=new P(10,2)}get sprite(){let e=this.sprites[this.spritesAnimation.currentAnimationStep];return this.spritesAnimation.update(this.Game.dt),e}}}(a||(a={})),function(e){function t(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}e.getIntInclusive=t,e.getOneInt=function(e){return 1===t(1,e)}}(l||(l={})),(s=i||(i={}))[s.Up=0]="Up",s[s.Right=1]="Right",s[s.Down=2]="Down",s[s.Left=3]="Left",function(e){e.getRandom=function(){switch(l.getIntInclusive(1,4)){case 1:return e.Up;case 2:return e.Right;case 3:return e.Down;case 4:default:return e.Left}},e.getOpposite=function(t){switch(t){case e.Up:return e.Down;case e.Down:return e.Up;case e.Left:return e.Right;case e.Right:default:return e.Left}},e.areOpposite=function(t,a){return t===e.Up&&a===e.Down||t===e.Down&&a===e.Up||t===e.Right&&a===e.Left||t===e.Left&&a===e.Right},e.isVertical=function(t){switch(t){case e.Up:case e.Down:return!0;case e.Left:case e.Right:default:return!1}},e.isHorizontal=function(t){switch(t){case e.Up:case e.Down:return!0;case e.Left:case e.Right:default:return!1}}}(i||(i={})),(d=n||(n={})).trunc=function(e,t=0){return t=Math.trunc(t),Math.trunc(e*10**t)/10**t},d.round=function(e,t=0){return t=Math.trunc(t),Math.round(e*10**t)/10**t};class W{constructor(){t(this,"_x"),t(this,"_y"),t(this,"_width"),t(this,"_height")}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get x(){return this._x}set x(e){this._x=n.round(e,7)}get y(){return this._y}set y(e){this._y=n.round(e,7)}}class M extends W{constructor(){super(),t(this,"_dx",0),t(this,"_dy",0),t(this,"_direction"),t(this,"_hitBox"),this.hitBox=this}get dx(){return this._dx}set dx(e){this._dx=e}get dy(){return this._dy}set dy(e){this._dy=e}get direction(){return this._direction}set direction(e){this._direction=e}get hitBox(){return this._hitBox}set hitBox(e){this._hitBox=e}}class A{constructor({box:e,x:a,y:l,width:i,height:s}){t(this,"_Box"),t(this,"_hitX"),t(this,"_hitY"),t(this,"_hitWidth"),t(this,"_hitHeight"),this._Box=e,this._hitX=a,this._hitY=l,this._hitWidth=i,this._hitHeight=s}get x(){return this._Box.x+this._hitX}set x(e){this._Box.x=e-this._hitX}get y(){return this._Box.y+this._hitY}set y(e){this._Box.y=e-this._hitY}get width(){return this._hitWidth}get height(){return this._hitHeight}get dx(){return this._Box.dx}set dx(e){this._Box.dx=e}get dy(){return this._Box.dy}set dy(e){this._Box.dy=e}get direction(){return this._Box.direction}set direction(e){this._Box.direction=e}}class E{constructor(e){t(this,"box"),t(this,"halfLeftHitBox"),t(this,"halfRightHitBox"),t(this,"halfUpHitBox"),t(this,"halfDownHitBox"),this.box=e,this.halfLeftHitBox=new A({box:this.box,x:0,y:0,width:this.box.width/2,height:this.box.height}),this.halfRightHitBox=new A({box:this.box,x:this.box.width/2,y:0,width:this.box.width/2,height:this.box.height}),this.halfUpHitBox=new A({box:this.box,x:0,y:0,width:this.box.width,height:this.box.height/2}),this.halfDownHitBox=new A({box:this.box,x:0,y:this.box.height/2,width:this.box.width,height:this.box.height/2})}}!function(e){function t(e,t){return!(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)}function a(e,a){let l={x:e.x,y:e.y,width:e.width,height:e.height};return e.dx>0?l.width+=e.dx:e.dx<0&&(l.x-=Math.abs(e.dx),l.width+=Math.abs(e.dx)),e.dy>0?l.height+=e.dy:e.dy<0&&(l.y-=Math.abs(e.dy),l.height+=Math.abs(e.dy)),t(l,a)}function l(e,t){return!(e.x+e.dx+e.width<=t.width&&e.x+e.dx>=0&&e.y+e.dy+e.height<=t.height&&e.y+e.dy>=0)}function s(e,t,a){switch(a){case i.Up:if(e.y+e.dy<t)return!0;break;case i.Down:if(e.y+e.dy+e.height>t)return!0;break;case i.Left:if(e.x+e.dx<t)return!0;break;case i.Right:if(e.x+e.dx+e.width>t)return!0}return!1}e.simpleBox=t,e.simpleMovingBox=a,e.movingBox=function(e,t){return!!a(e,t)&&(e.dx>0&&e.x+e.width<=t.x?e.dx=t.x-(e.x+e.width):e.dx<0&&e.x>=t.x+t.width&&(e.dx=t.x+t.width-e.x),e.dy>0&&e.y+e.height<=t.y?e.dy=t.y-(e.y+e.height):e.dy<0&&e.y>=t.y+t.height&&(e.dy=t.y+t.height-e.y),!0)},e.movingBoxs=function(e,t){return!(e.x+e.dx>=t.x+t.width+e.dx||e.x+e.dx+e.width<=t.x+e.dx||e.y+e.dy>=t.y+t.height+e.dy||e.y+e.dy+e.height<=t.y+e.dy)},e.simpleMovingBoxCanvas=l,e.movingBoxCanvas=function(e,t){return!!l(e,t)&&(e.x+e.dx+e.width>t.width&&(e.dx=0,e.x=t.width-e.width),e.x+e.dx<0&&(e.dx=0,e.x=0),e.y+e.dy+e.height>t.height&&(e.dy=0,e.y=t.height-e.height),e.y+e.dy<0&&(e.dy=0,e.y=0),!0)},e.simpleMovingBoxLine=s,e.movingBoxLine=function(e,t,a){if(s(e,t,a)){switch(a){case i.Up:e.y=t+1,e.dy=0;break;case i.Down:e.y=t-e.height,e.dy=0;break;case i.Left:e.x=t+1,e.dx=0;break;case i.Right:e.x=t-e.width,e.dx=0}return!0}return!1},e.passBetweenBoxesHelper=function(t){let a=!1,l=!1,s=!1,n=!1;if(t.Game.Viewport.loopCollision((i=>{e.simpleMovingBox(t.hitBox,i)&&(e.simpleMovingBox(t.halfHitBoxes.halfLeftHitBox,i)&&(a=!0),e.simpleMovingBox(t.halfHitBoxes.halfRightHitBox,i)&&(l=!0),e.simpleMovingBox(t.halfHitBoxes.halfUpHitBox,i)&&(s=!0),e.simpleMovingBox(t.halfHitBoxes.halfDownHitBox,i)&&(n=!0))})),t.direction===i.Up||t.direction===i.Down){if(a&&!l)return t.dx=t.speed*t.Game.dt,!0;if(!a&&l)return t.dx=-t.speed*t.Game.dt,!0}else if(t.direction===i.Left||t.direction===i.Right){if(s&&!n)return t.dy=t.speed*t.Game.dt,!0;if(!s&&n)return t.dy=-t.speed*t.Game.dt,!0}return!1}}(h||(h={}));class H extends W{constructor(){super(),t(this,"Game"),t(this,"sprite"),t(this,"collisionSound")}collisionCallback(){}}class F extends H{constructor(e,t,a){super(),this.Game=e,this.x=t,this.y=a,this.width=24,this.height=24,this.sprite=I.load("./sprites/png/full-heart.png"),this.collisionSound=R.load("./sounds/effect/Get_Heart.wav")}collisionCallback(){this.Game.Player.recoverHealth(2)}}class V extends H{constructor(e,t,a){super(),this.Game=e,this.x=t,this.y=a,this.width=32,this.height=32,this.sprite=I.load("./sprites/png/clock.png"),this.collisionSound=R.load("./sounds/effect/Get_Item.wav")}collisionCallback(){this.Game.Player.getInvicibility(400)}}class U extends H{constructor(e,t,a){super(),this.Game=e,this.x=t,this.y=a,this.width=28,this.height=64,this.sprite=I.load("./sprites/png/sword-up.png"),this.collisionSound=R.load("./sounds/effect/Fanfare.wav")}collisionCallback(){this.Game.Player.getImportantItem(this),this.Game.Sword.isEnabled=!0}}class _ extends H{constructor(e,t,a){super(),this.Game=e,this.x=t,this.y=a,this.width=26,this.height=26,this.sprite=I.load("./sprites/png/heart-receptacle.png"),this.collisionSound=R.load("./sounds/effect/Fanfare.wav")}collisionCallback(){this.Game.Player.getImportantItem(this),this.Game.Player.maxHp+=2,this.Game.Player.recoverHealth()}}(r=u||(u={}))[r.Moving=0]="Moving",r[r.ShieldBlocked=1]="ShieldBlocked";class N extends M{constructor(e,a){switch(super(),t(this,"Game"),t(this,"speed"),t(this,"damage"),t(this,"sprites"),t(this,"hasPlayerCollision"),t(this,"canBeShieldBlocked"),t(this,"hasEnemiesCollision"),t(this,"state"),this.speed=e,this.direction=a,this.direction){case i.Up:this.dy=-this.speed;break;case i.Right:this.dx=this.speed;break;case i.Down:this.dy=this.speed;break;case i.Left:this.dx=-this.speed}this.sprites=[],this.state=new B(0)}playerCollisionCallback(){this.Game.Player.takeDamage(this.damage)}enemiesCollisionCallback(e){e.takeDamage(this.damage)}deleteCallback(){}}class T extends N{constructor(e,a,l,s,n,d){super(s,n),t(this,"sprite"),this.Game=e,this.x=a,this.y=l,this.width=24,this.height=30,this.damage=d,this.sprite=I.load("./sprites/png/fireball.png"),this.sprites[i.Up]=this.sprite,this.sprites[i.Down]=this.sprite,this.sprites[i.Right]=this.sprite,this.sprites[i.Left]=this.sprite,this.hasPlayerCollision=!0,this.canBeShieldBlocked=!0,this.hasEnemiesCollision=!1}}class j extends N{constructor(e,t,a,l,s,n){super(l,s),this.Game=e,this.x=t,this.y=a,this.width=i.isVertical(s)?20:64,this.height=i.isVertical(s)?64:20,this.damage=n,this.sprites[i.Up]=I.load("./sprites/png/arrow-up.png"),this.sprites[i.Down]=I.load("./sprites/png/arrow-down.png"),this.sprites[i.Right]=I.load("./sprites/png/arrow-right.png"),this.sprites[i.Left]=I.load("./sprites/png/arrow-left.png"),this.hasPlayerCollision=!0,this.canBeShieldBlocked=!0,this.hasEnemiesCollision=!1}}class z extends N{constructor(e,t,a,l,s,n){super(l,s),this.Game=e,this.x=t,this.y=a,this.width=i.isVertical(s)?28:64,this.height=i.isVertical(s)?64:28,this.damage=n,this.sprites=this.Game.Sword.sprites,this.hasPlayerCollision=!1,this.canBeShieldBlocked=!1,this.hasEnemiesCollision=!0}deleteCallback(){this.Game.Sword.isFlying=!1}}(w=o||(o={}))[w.Moving=0]="Moving",w[w.ChangeDirection=1]="ChangeDirection",w[w.Wait=2]="Wait",w[w.Attack=3]="Attack",w[w.Killed=4]="Killed";class K extends M{constructor(){super(),t(this,"Game"),t(this,"hp"),t(this,"speed"),t(this,"damage"),t(this,"isKilledAnimationFinished"),t(this,"hasPlayerCollision"),t(this,"hasViewportCollision"),t(this,"hasBricksCollisions"),t(this,"requirePassBetweenBoxHelper"),t(this,"spritesAnimation"),t(this,"killedSprites",[]),t(this,"invincibleObserver"),t(this,"invincibleDuration"),t(this,"invincibleAnimation"),t(this,"state"),t(this,"dieSound"),t(this,"hitSound"),this.hasPlayerCollision=!0,this.hasViewportCollision=!0,this.hasBricksCollisions=!0,this.requirePassBetweenBoxHelper=!1,this.isKilledAnimationFinished=!1,this.killedSprites[1]=I.load("./sprites/png/killed1.png"),this.killedSprites[2]=I.load("./sprites/png/killed2.png"),this.invincibleObserver=new B(!1),this.invincibleDuration=25,this.invincibleAnimation=new P(7,2),this.dieSound=R.load("./sounds/effect/Enemy_Die.wav"),this.hitSound=R.load("./sounds/effect/Enemy_Hit.wav")}aiThinking(){}move(){this.y+=this.dy,this.x+=this.dx,this.dx=0,this.dy=0}draw(){}playerCollision(){this.Game.Player.takeDamage(this.damage)}viewportCollision(){}bricksCollision(){}customCollision(){}moveHelper(){return!1}takeDamage(e){if(!this.invincibleObserver.is(!0)&&!this.state.is(4)){if(this.hp-=e,this.hp<=0)return this.dieSound.play(),void this.state.setNextState(4);this.getInvicibility(),this.hitSound.play()}}getInvicibility(){this.invincibleObserver.setNextState(!0)}dropItem(){return!!(this.Game.Player.hp<this.Game.Player.maxHp&&l.getOneInt(3))&&(this.Game.ItemManager.addItem(new F(this.Game,this.x+this.width/2-12,this.y+this.height/2-12)),!0)}}class q extends K{constructor({width:e,height:a}){super(),t(this,"hasChangedDirection"),t(this,"sprites",[]),t(this,"halfHitBoxes"),this.width=e,this.height=a,this.state=new B(1),this.halfHitBoxes=new E(this.hitBox),this.requirePassBetweenBoxHelper=!0}aiThinking(){switch(this.state.get()){case 0:if(this.invincibleObserver.is(!1))switch(this.direction){case i.Down:this.dy=this.speed*this.Game.dt;break;case i.Up:this.dy=-this.speed*this.Game.dt;break;case i.Right:this.dx=this.speed*this.Game.dt;break;case i.Left:this.dx=-this.speed*this.Game.dt}this.state.currentFrame>50&&(l.getOneInt(25)?this.changeDirection():l.getOneInt(25)&&this.state.setNextState(3));break;case 1:this.state.currentFrame>=15&&!this.hasChangedDirection&&(this.direction=i.getRandom(),this.hasChangedDirection=!0),this.state.currentFrame>30&&this.state.setNextState(0);break;case 3:this.state.isFirstFrame&&this.attack(),this.state.currentFrame>30&&this.state.setNextState(0)}}viewportCollision(){this.changeDirection()}bricksCollision(){this.changeDirection()}moveHelper(){return h.passBetweenBoxesHelper(this)}changeDirection(){this.state.setNextState(1),this.hasChangedDirection=!1}draw(){this.Game.Viewport.currentScene.drawImage({sprite:this.sprites[this.direction][this.spritesAnimation.currentAnimationStep],x:this.x,y:this.y,width:this.width,height:this.height})}attack(){}}class Y extends q{constructor({game:e,x:t,y:a,speed:l,direction:s}){super({width:64,height:64}),this.Game=e,this.x=t,this.y=a,this.speed=l,this.direction=s,this.damage=1,this.hp=1,this.sprites[i.Up]=[],this.sprites[i.Up][1]=I.load("./sprites/png/octorok-up1.png"),this.sprites[i.Up][2]=I.load("./sprites/png/octorok-up2.png"),this.sprites[i.Down]=[],this.sprites[i.Down][1]=I.load("./sprites/png/octorok-down1.png"),this.sprites[i.Down][2]=I.load("./sprites/png/octorok-down2.png"),this.sprites[i.Right]=[],this.sprites[i.Right][1]=I.load("./sprites/png/octorok-right1.png"),this.sprites[i.Right][2]=I.load("./sprites/png/octorok-right2.png"),this.sprites[i.Left]=[],this.sprites[i.Left][1]=I.load("./sprites/png/octorok-left1.png"),this.sprites[i.Left][2]=I.load("./sprites/png/octorok-left2.png"),this.spritesAnimation=new P(20/l,2)}attack(){this.Game.ProjectileManager.addProjectile(new T(this.Game,this.x+this.width/2-12,this.y+this.height/2-15,8,this.direction,this.damage))}}class X extends Y{constructor({game:e,x:t,y:a,speed:l,direction:s}){super({game:e,x:t,y:a,speed:l,direction:s}),this.damage=2,this.hp=2,this.sprites[i.Up]=[],this.sprites[i.Up][1]=I.load("./sprites/png/blue-octorok-up1.png"),this.sprites[i.Up][2]=I.load("./sprites/png/blue-octorok-up2.png"),this.sprites[i.Down]=[],this.sprites[i.Down][1]=I.load("./sprites/png/blue-octorok-down1.png"),this.sprites[i.Down][2]=I.load("./sprites/png/blue-octorok-down2.png"),this.sprites[i.Right]=[],this.sprites[i.Right][1]=I.load("./sprites/png/blue-octorok-right1.png"),this.sprites[i.Right][2]=I.load("./sprites/png/blue-octorok-right2.png"),this.sprites[i.Left]=[],this.sprites[i.Left][1]=I.load("./sprites/png/blue-octorok-left1.png"),this.sprites[i.Left][2]=I.load("./sprites/png/blue-octorok-left2.png")}dropItem(){return!!super.dropItem()||!(!l.getOneInt(3)||this.Game.Player.invincibleObserver.is(!0))&&(this.Game.ItemManager.addItem(new V(this.Game,this.x+this.width/2-16,this.y+this.height/2-16)),!0)}}class Q extends q{constructor({game:e,x:a,y:l,speed:s,direction:n}){super({width:64,height:64}),t(this,"arrowSprites"),this.Game=e,this.x=a,this.y=l,this.width=64,this.height=64,this.speed=s,this.direction=n,this.damage=1,this.hp=1,this.sprites[i.Up]=[],this.sprites[i.Up][1]=I.load("./sprites/png/moblin-up1.png"),this.sprites[i.Up][2]=I.load("./sprites/png/moblin-up2.png"),this.sprites[i.Down]=[],this.sprites[i.Down][1]=I.load("./sprites/png/moblin-down1.png"),this.sprites[i.Down][2]=I.load("./sprites/png/moblin-down2.png"),this.sprites[i.Right]=[],this.sprites[i.Right][1]=I.load("./sprites/png/moblin-right1.png"),this.sprites[i.Right][2]=I.load("./sprites/png/moblin-right2.png"),this.sprites[i.Left]=[],this.sprites[i.Left][1]=I.load("./sprites/png/moblin-left1.png"),this.sprites[i.Left][2]=I.load("./sprites/png/moblin-left2.png"),this.spritesAnimation=new P(25/s,2)}attack(){this.Game.ProjectileManager.addProjectile(new j(this.Game,this.x+this.width/2-12,this.y+this.height/2-15,8,this.direction,this.damage))}}class J extends Q{constructor({game:e,x:t,y:a,speed:l,direction:s}){super({game:e,x:t,y:a,speed:l,direction:s}),this.damage=2,this.hp=2,this.sprites[i.Up]=[],this.sprites[i.Up][1]=I.load("./sprites/png/blue-moblin-up1.png"),this.sprites[i.Up][2]=I.load("./sprites/png/blue-moblin-up2.png"),this.sprites[i.Down]=[],this.sprites[i.Down][1]=I.load("./sprites/png/blue-moblin-down1.png"),this.sprites[i.Down][2]=I.load("./sprites/png/blue-moblin-down2.png"),this.sprites[i.Right]=[],this.sprites[i.Right][1]=I.load("./sprites/png/blue-moblin-right1.png"),this.sprites[i.Right][2]=I.load("./sprites/png/blue-moblin-right2.png"),this.sprites[i.Left]=[],this.sprites[i.Left][1]=I.load("./sprites/png/blue-moblin-left1.png"),this.sprites[i.Left][2]=I.load("./sprites/png/blue-moblin-left2.png")}dropItem(){return!!super.dropItem()||!(!l.getOneInt(3)||this.Game.Player.invincibleObserver.is(!0))&&(this.Game.ItemManager.addItem(new V(this.Game,this.x+this.width/2-16,this.y+this.height/2-16)),!0)}}class Z extends K{constructor({game:e,x:a,y:l}){super(),t(this,"sprites"),t(this,"speedX"),t(this,"speedY"),this.Game=e,this.x=a,this.y=l,this.width=64,this.height=64,this.speed=6,this.direction=i.Down,this.damage=1,this.hp=1,this.hasViewportCollision=!1,this.hasBricksCollisions=!1,this.sprites=[],this.sprites[1]=I.load("./sprites/png/tektite1.png"),this.sprites[2]=I.load("./sprites/png/tektite2.png"),this.spritesAnimation=new P(20,2),this.state=new B(2)}aiThinking(){switch(this.state.get()){case 0:this.state.isFirstFrame?(this.dy=-6,this.dx=this.dy/2*(l.getOneInt(2)?-1:1)):this.dy=this.dy+.1*this.Game.dt,(this.state.currentFrame>60&&l.getOneInt(50)||this.state.currentFrame>100)&&this.state.setNextState(2);break;case 2:this.dx=0,this.dy=0,(this.state.currentFrame>30&&l.getOneInt(50)||this.state.currentFrame>60)&&this.state.setNextState(0)}}customCollision(){h.movingBoxLine(this.hitBox,0,i.Up)&&(this.dy=this.dy/2),h.movingBoxLine(this.hitBox,this.Game.Viewport.height,i.Down)&&this.state.setNextState(2),h.simpleMovingBoxLine(this.hitBox,0,i.Left)&&(this.dx=-this.dx),h.simpleMovingBoxLine(this.hitBox,this.Game.Viewport.width,i.Right)&&(this.dx=-this.dx)}move(){this.state.is(4)||(this.y+=this.dy*this.Game.dt,this.x+=this.dx*this.Game.dt)}draw(){let e;switch(this.state.get()){case 0:e=this.sprites[1];break;case 2:e=this.sprites[this.spritesAnimation.currentAnimationStep]}this.Game.Viewport.currentScene.drawImage({sprite:e,x:this.x,y:this.y,width:this.width,height:this.height})}}class $ extends Z{constructor({game:e,x:t,y:a}){super({game:e,x:t,y:a}),this.damage=2,this.sprites=[],this.sprites[1]=I.load("./sprites/png/blue-tektite1.png"),this.sprites[2]=I.load("./sprites/png/blue-tektite2.png")}dropItem(){return!!super.dropItem()||!(!l.getOneInt(3)||this.Game.Player.invincibleObserver.is(!0))&&(this.Game.ItemManager.addItem(new V(this.Game,this.x+this.width/2-16,this.y+this.height/2-16)),!0)}}class ee extends W{constructor({game:e,scene:a,c:l,r:i,targetWorldIndex:s,targetSceneC:n,targetSceneR:d}){super(),t(this,"Game"),t(this,"Scene"),t(this,"targetWorldIndex"),t(this,"targetSceneC"),t(this,"targetSceneR"),this.Game=e,this.Scene=a,this.x=l*this.Scene.cellSize,this.y=i*this.Scene.cellSize,this.width=this.Scene.cellSize,this.height=this.Scene.cellSize,this.targetWorldIndex=s,this.targetSceneC=n,this.targetSceneR=d}}class te extends W{constructor({x:e,y:a,size:l,brick:i}){super(),t(this,"brick"),this.x=e,this.y=a,this.width=l,this.height=l,this.brick=i}}class ae{constructor({game:e,world:a,c:l,r:i,music:s,defaultBrick:n,backgroundColor:d}){t(this,"Game"),t(this,"World"),t(this,"cells",[]),t(this,"x"),t(this,"y"),t(this,"c"),t(this,"r"),t(this,"nbRow"),t(this,"nbCol"),t(this,"cellSize"),t(this,"enemies"),t(this,"passages"),t(this,"permanentItems"),t(this,"music"),t(this,"defaultBrick"),t(this,"defaultWallBrick"),t(this,"backgroundColor"),this.Game=e,this.World=a,this.nbRow=11,this.nbCol=16,this.cellSize=64,this.enemies=[],this.passages=[],this.permanentItems=[],this.x=0,this.y=0,this.c=l,this.r=i,this.music=s,this.backgroundColor=d;for(let t=0;t<this.nbCol;t++){this.cells[t]=[];for(let e=0;e<this.nbRow;e++)this.cells[t][e]=new te({x:this.cellSize*t,y:this.cellSize*e,size:this.cellSize,brick:n})}}get width(){return this.cellSize*this.nbCol}get height(){return this.cellSize*this.nbRow}get hasEnemies(){return this.enemies.length>0}get hasPermanentItems(){return this.permanentItems.length>0}getCell(e,t){return this.cells[e][t]}loadBricks(e){e.forEach(((e,t)=>{e.forEach(((e,a)=>{this.cells[a][t].brick=this.Game.BrickCollection.get(e)}))}))}drawImage({sprite:e,x:t,y:a,width:l,height:i}){this.Game.Viewport.drawImage({sprite:e,x:t+this.x,y:a+this.y,width:l,height:i})}fillRect({x:e,y:t,width:a,height:l,color:i}){this.Game.Viewport.fillRect({x:e+this.x,y:t+this.y,width:a,height:l,color:i})}upperEdgeCollision(){this.Game.Viewport.slideScene(i.Up)}rightEdgeCollision(){this.Game.Viewport.slideScene(i.Right)}bottomEdgeCollision(){this.Game.Viewport.slideScene(i.Down)}leftEdgeCollision(){this.Game.Viewport.slideScene(i.Left)}}class le{constructor({game:e,nbCol:a,nbRow:l,defaultMusic:i,defaultBrick:s,defaultBackgroundColor:n}){t(this,"Game"),t(this,"scenes",[]),t(this,"nbCol"),t(this,"nbRow"),this.Game=e,this.nbCol=a,this.nbRow=l;for(let t=0;t<this.nbCol;t++){this.scenes[t]=[];for(let e=0;e<this.nbRow;e++)this.scenes[t][e]=new ae({game:this.Game,world:this,c:t,r:e,music:i,defaultBrick:s,backgroundColor:n})}}loopScenes(e){this.scenes.forEach((t=>{t.forEach((t=>{e(t)}))}))}}class ie{constructor(e){t(this,"Game"),t(this,"worlds"),t(this,"spawnWorldIndex"),t(this,"spawnSceneColl"),t(this,"spawnSceneRow"),t(this,"spawnCellColl"),t(this,"spawnCellRow"),this.Game=e,this.spawnWorldIndex=0,this.spawnSceneColl=1,this.spawnSceneRow=2,this.spawnCellColl=7,this.spawnCellRow=5.5,this.worlds=[],this.worlds[0]=new le({game:this.Game,nbCol:3,nbRow:3,defaultMusic:R.load("./sounds/music/overworld.mp3",!0),defaultBrick:this.Game.BrickCollection.get("default"),defaultBackgroundColor:"#ffd4aa"}),this.worlds[0].scenes[0][0].loadBricks([["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["white-wall","white-wall-br","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","default","default","grave","default","default","grave","default","default","grave","default","default","grave","default","default","default"],["white-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","default","default","grave","default","default","grave","default","default","grave","default","default","grave","default","default","default"],["white-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","default","default","grave","default","default","grave","default","default","default","default","default","grave","default","default","default"],["white-wall","white-wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","white-wall","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","stairs","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","stairs","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"]]),this.worlds[0].scenes[0][0].backgroundColor="#747474",this.worlds[0].scenes[0][0].music=R.load("./sounds/music/death_mountain.mp3",!0),this.worlds[0].scenes[0][0].enemies=[new X({game:this.Game,x:128,y:128,speed:4,direction:l.getOneInt(2)?i.Right:i.Down}),new X({game:this.Game,x:320,y:320,speed:4,direction:l.getOneInt(2)?i.Up:i.Down}),new X({game:this.Game,x:832,y:192,speed:4,direction:l.getOneInt(2)?i.Up:i.Down})],this.worlds[0].scenes[1][0].loadBricks([["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["default","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","default"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["default","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","default"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["default","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","default"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","white-wall","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"]]),this.worlds[0].scenes[1][0].backgroundColor="#747474",this.worlds[0].scenes[1][0].music=R.load("./sounds/music/death_mountain.mp3",!0),this.worlds[0].scenes[1][0].enemies=[new J({game:this.Game,x:320,y:512,speed:4,direction:i.Up}),new J({game:this.Game,x:512,y:256,speed:4,direction:l.getOneInt(2)?i.Right:i.Left}),new J({game:this.Game,x:640,y:128,speed:4,direction:i.Down})],this.worlds[0].scenes[2][0].loadBricks([["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","passage","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","white-wall-bl","white-wall","white-wall"],["default","default","default","monument-tl","monument-tr","default","default","white-tree","default","default","monument-tl","monument-tr","default","default","white-wall","white-wall"],["default","default","default","monument-bl","monument-br","default","default","default","default","default","monument-bl","monument-br","default","default","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","white-wall","white-wall"],["default","default","default","default","default","default","grave","default","grave","default","default","default","default","default","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","white-wall-tl","white-wall","white-wall"],["white-wall","white-wall","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall","white-wall","white-wall"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"]]),this.worlds[0].scenes[2][0].backgroundColor="#747474",this.worlds[0].scenes[2][0].music=R.load("./sounds/music/death_mountain.mp3",!0),this.worlds[0].scenes[2][0].passages=[new ee({game:this.Game,scene:this.worlds[0].scenes[2][0],c:7,r:1,targetWorldIndex:2,targetSceneC:1,targetSceneR:1})],this.worlds[0].scenes[2][0].enemies=[new X({game:this.Game,x:320,y:256,speed:4,direction:i.Down}),new X({game:this.Game,x:576,y:384,speed:4,direction:i.Right}),new X({game:this.Game,x:768,y:192,speed:4,direction:i.Down}),new $({game:this.Game,x:448,y:448})],this.worlds[0].scenes[0][1].loadBricks([["wall","wall","wall","wall","wall","wall","wall","wall","wall","stairs","wall","wall","wall","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","stairs","wall","wall","wall","wall","wall","wall"],["wall","wall-br","default","default","default","default","default","default","default","default","default","default","default","default","wall-bl","wall"],["wall","default","default","single-red-wall","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default","default","default","default","wall-bl"],["wall","default","default","default","default","default","default","default","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default"],["wall","default","default","single-red-wall","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default","default","default","default","default"],["wall","default","default","default","default","default","default","default","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default"],["wall","default","default","single-red-wall","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default","default","default","default","wall-tl"],["wall","wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","wall-tl","wall"],["wall","wall","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-tr","default","default","wall-tl","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","default","default","wall","wall","wall"]]),this.worlds[0].scenes[0][1].enemies=[new Y({game:this.Game,x:384,y:256,speed:3,direction:l.getOneInt(2)?i.Right:i.Left}),new Y({game:this.Game,x:256,y:384,speed:3,direction:l.getOneInt(2)?i.Right:i.Left}),new Y({game:this.Game,x:448,y:128,speed:3,direction:l.getOneInt(2)?i.Up:i.Down}),new Y({game:this.Game,x:832,y:128,speed:3,direction:i.Down})],this.worlds[0].scenes[1][1].loadBricks([["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall-br","default","default","default","default","default","default","wall-bl","wall-br","default","default","default","default","wall-bl","wall"],["wall-br","default","default","single-wall","default","single-wall","default","default","default","default","default","default","single-wall","default","default","wall-bl"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["default","default","default","single-wall","default","single-wall","default","default","default","default","default","default","single-wall","default","default","default"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["wall-tr","default","default","single-wall","default","single-wall","default","default","default","default","default","default","single-wall","default","default","wall-tl"],["wall","wall-tr","default","default","default","default","default","default","wall-tl","wall-tr","default","default","default","default","wall-tl","wall"],["wall","wall","wall-t","wall-t","wall-t","wall-t","default","default","wall","wall","wall-t","wall-t","wall-t","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","default","default","wall","wall","wall","wall","wall","wall","wall","wall"]]),this.worlds[0].scenes[1][1].enemies=[new Y({game:this.Game,x:256,y:320,speed:3,direction:l.getOneInt(2)?i.Up:i.Down}),new Y({game:this.Game,x:640,y:192,speed:3,direction:l.getOneInt(2)?i.Up:i.Down}),new Y({game:this.Game,x:832,y:448,speed:3,direction:l.getOneInt(2)?i.Up:i.Down}),new Y({game:this.Game,x:768,y:384,speed:3,direction:l.getOneInt(2)?i.Right:i.Left})],this.worlds[0].scenes[2][1].loadBricks([["wall","wall","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree"],["wall","wall","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree"],["wall","wall-br","default","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall-br","default","default","default","default","default","default","tree","default","default","default","tree","default","tree","default","tree"],["default","default","tree","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["default","default","default","default","tree","default","default","tree","default","tree","default","tree","default","tree","default","tree"],["default","default","tree","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall-tr","default","default","default","default","default","default","tree","default","default","default","tree","default","tree","default","tree"],["wall","wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall","wall","tree","default","tree","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall","wall","tree","default","tree","default","tree","default","default","tree","default","tree","default","tree","default","tree"]]),this.worlds[0].scenes[2][1].enemies=[new Y({game:this.Game,x:192,y:256,speed:3,direction:l.getOneInt(2)?i.Right:i.Left}),new Y({game:this.Game,x:320,y:384,speed:3,direction:l.getOneInt(2)?i.Right:i.Left}),new Y({game:this.Game,x:640,y:320,speed:3,direction:l.getOneInt(2)?i.Up:i.Down}),new Y({game:this.Game,x:896,y:128,speed:3,direction:l.getOneInt(2)?i.Left:i.Down})],this.worlds[0].scenes[0][2].loadBricks([["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","default","default","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall-br","default","default","wall","wall","wall"],["wall","wall-br","default","default","default","default","default","default","default","default","default","default","default","wall","wall","wall"],["wall","default","default","default","default","default","default","single-wall","default","default","default","default","default","wall-bl","wall","wall"],["wall","default","default","default","default","default","default","default","default","single-wall","default","default","default","default","wall-bl","wall"],["wall","default","default","default","single-wall","default","default","single-wall","default","default","default","default","default","default","default","default"],["wall","default","default","default","default","default","default","default","default","single-wall","default","default","default","default","wall-tl","wall-t"],["wall","wall-tr","default","default","default","default","default","single-wall","default","default","default","default","default","wall-tl","wall","wall"],["wall","wall","default","default","default","default","default","default","default","default","default","default","default","wall","wall","wall"],["wall","wall","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"]]),this.worlds[0].scenes[0][2].enemies=[new Z({game:this.Game,x:192,y:256}),new Z({game:this.Game,x:320,y:448}),new Z({game:this.Game,x:640,y:320})],this.worlds[0].scenes[1][2].loadBricks([["wall","wall","wall","wall","wall","wall","default","default","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall","wall","passage","wall","wall-br","default","default","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall","wall-br","default","default","default","default","default","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall-br","default","default","default","default","default","default","wall-bl","wall","wall","wall","wall","wall","wall","wall"],["wall-br","default","default","default","default","default","default","default","default","wall-bl","wall","wall","wall","wall","wall","wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["wall-t","default","default","default","default","default","default","default","default","default","default","default","default","default","wall-tl","wall-t"],["wall","wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","wall","wall"],["wall","wall","wall-tr","default","default","default","default","default","default","default","default","default","default","wall-tl","wall","wall"],["wall","wall","wall","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"]]),this.worlds[0].scenes[1][2].passages=[new ee({game:this.Game,scene:this.worlds[0].scenes[1][2],c:3,r:1,targetWorldIndex:1,targetSceneC:0,targetSceneR:0})],this.worlds[0].scenes[2][2].loadBricks([["wall","wall","tree","default","tree","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall","wall","tree","default","tree","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall","wall","default","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall","wall-br","default","default","default","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall-br","default","tree","default","tree","default","default","default","default","default","default","default","default","default","default","tree"],["default","default","default","default","default","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall-t","default","tree","default","tree","default","default","default","default","default","default","default","default","default","default","tree"],["wall","default","default","default","default","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall","wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall","wall","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree"],["wall","wall","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree"]]),this.worlds[0].scenes[2][2].enemies=[new Q({game:this.Game,x:192,y:320,speed:3,direction:l.getOneInt(2)?i.Up:i.Down}),new Q({game:this.Game,x:320,y:448,speed:3,direction:l.getOneInt(2)?i.Up:i.Down}),new Q({game:this.Game,x:640,y:320,speed:3,direction:l.getOneInt(2)?i.Up:i.Down}),new Q({game:this.Game,x:768,y:448,speed:3,direction:l.getOneInt(2)?i.Up:i.Down})],this.worlds[1]=new le({game:this.Game,nbCol:1,nbRow:1,defaultMusic:R.load("./sounds/music/death_mountain.mp3",!0),defaultBrick:this.Game.BrickCollection.get("default"),defaultBackgroundColor:"#0f0e0b"}),this.worlds[1].scenes[0][0].loadBricks([["red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","fire","default","default","default","default","default","default","default","default","fire","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","default","default","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall"]]),this.worlds[1].scenes[0][0].permanentItems=[new U(this.Game,498,320)],this.worlds[1].scenes[0][0].bottomEdgeCollision=function(){this.Game.Viewport.changeWorld(!1,0,1,2,3,1)},this.worlds[2]=new le({game:this.Game,nbCol:2,nbRow:2,defaultMusic:R.load("./sounds/music/dungeon.mp3",!0),defaultBrick:this.Game.BrickCollection.get("default-dungeon"),defaultBackgroundColor:"#078382"}),this.worlds[2].scenes[0][0].loadBricks([["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"]]),this.worlds[2].scenes[0][0].enemies=[new X({game:this.Game,x:128,y:128,speed:4,direction:l.getOneInt(2)?i.Right:i.Down}),new X({game:this.Game,x:320,y:320,speed:4,direction:l.getOneInt(2)?i.Up:i.Down}),new X({game:this.Game,x:832,y:192,speed:4,direction:l.getOneInt(2)?i.Up:i.Down}),new X({game:this.Game,x:512,y:384,speed:4,direction:l.getOneInt(2)?i.Up:i.Down})],this.worlds[2].scenes[1][0].loadBricks([["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"]]),this.worlds[2].scenes[1][0].permanentItems=[new _(this.Game,499,320)],this.worlds[2].scenes[0][1].loadBricks([["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"]]),this.worlds[2].scenes[0][1].enemies=[new $({game:this.Game,x:128,y:128}),new $({game:this.Game,x:320,y:320}),new $({game:this.Game,x:832,y:192}),new $({game:this.Game,x:512,y:384})],this.worlds[2].scenes[1][1].loadBricks([["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"]]),this.worlds[2].scenes[1][1].bottomEdgeCollision=function(){this.Game.Viewport.changeWorld(!1,0,2,0,7,1)},this.worlds[2].scenes[1][1].enemies=[new J({game:this.Game,x:128,y:128,speed:4,direction:l.getOneInt(2)?i.Right:i.Down}),new J({game:this.Game,x:320,y:320,speed:4,direction:l.getOneInt(2)?i.Up:i.Down}),new J({game:this.Game,x:832,y:192,speed:4,direction:l.getOneInt(2)?i.Up:i.Down})]}getSpawnWorld(){return this.worlds[this.spawnWorldIndex]}getSpawnScene(){return this.worlds[this.spawnWorldIndex].scenes[this.spawnSceneColl][this.spawnSceneRow]}loopWorlds(e){this.worlds.forEach((t=>{e(t)}))}}class se{constructor(e){t(this,"Game"),t(this,"enemies",[]),this.Game=e,this.Game.Viewport.currentScene.hasEnemies&&(this.enemies=this.Game.Viewport.currentScene.enemies)}loopEnemies(e){this.enemies.forEach((t=>{e(t)}))}aiThinking(){this.loopEnemies((e=>{e.aiThinking()}))}collisions(){this.loopEnemies((e=>{e.hasPlayerCollision&&h.movingBoxs(this.Game.Player.hitBox,e.hitBox)&&!e.state.is(o.Killed)&&e.playerCollision();let t=e.moveHelper();e.hasBricksCollisions&&this.Game.Viewport.loopCollision((a=>{h.movingBox(e.hitBox,a)&&(t||e.bricksCollision())})),e.customCollision(),e.hasViewportCollision&&h.movingBoxCanvas(e.hitBox,this.Game.Viewport)&&e.viewportCollision()}))}move(){this.loopEnemies((e=>{e.move()}))}draw(){this.loopEnemies((e=>{e.state.is(o.Killed)?e.state.currentFrame<=10?this.Game.Viewport.currentScene.drawImage({sprite:e.killedSprites[1],x:e.x,y:e.y,width:e.width,height:e.height}):e.state.currentFrame<=20?this.Game.Viewport.currentScene.drawImage({sprite:e.killedSprites[2],x:e.x,y:e.y,width:e.width,height:e.height}):e.isKilledAnimationFinished=!0:(e.invincibleObserver.is(!0)?(e.invincibleAnimation.update(this.Game.dt),1===e.invincibleAnimation.currentAnimationStep&&e.draw()):e.draw(),this.Game.state.is(k.Run)&&e.spritesAnimation.update(this.Game.dt))}))}removeKilled(e=!1){this.loopEnemies((t=>{if(t.isKilledAnimationFinished||e&&t.state.is(o.Killed)){const e=this.enemies.indexOf(t);e>-1&&this.enemies.splice(e,1),this.Game.EnemyManager.enemies.length<=0&&this.Game.Player.increaseScore(),t.dropItem()}}))}updateObservers(){this.loopEnemies((e=>{e.state.update(this.Game.dt),e.invincibleObserver.update(this.Game.dt),e.invincibleObserver.get()&&e.invincibleObserver.currentFrame>e.invincibleDuration&&e.invincibleObserver.setNextState(!1)}))}}class ne{constructor(e){t(this,"Game"),t(this,"currentWorld"),t(this,"nextWorld"),t(this,"currentScene"),t(this,"nextScene"),t(this,"slideSceneDirection"),t(this,"targetCellR"),t(this,"targetCellC"),t(this,"changeWorldFromPassage"),t(this,"changeWorldToPassage"),t(this,"justReachOutPassage"),t(this,"x"),t(this,"y"),t(this,"slideSceneAnimationSpeed"),t(this,"music"),this.Game=e,this.currentWorld=this.Game.Map.getSpawnWorld(),this.nextWorld=null,this.currentScene=this.Game.Map.getSpawnScene(),this.nextScene=null,this.justReachOutPassage=!1,this.music=this.currentScene.music,this.x=0,this.y=0,this.slideSceneAnimationSpeed=10}get cellSize(){return this.currentScene.cellSize}get nbRow(){return this.currentScene.nbRow}get nbCol(){return this.currentScene.nbCol}get width(){return this.currentScene.cellSize*this.currentScene.nbCol}get height(){return this.currentScene.cellSize*this.currentScene.nbRow}loopCells(e,t=this.currentScene){for(let a=0;a<this.nbCol;a++)for(let l=0;l<this.nbRow;l++)e(t.getCell(a,l),a,l)}loopCollision(e){this.loopCells(((t,a,l)=>{t.brick.hasCollisions&&e(t,a,l)}))}draw(){this.Game.state.is(k.Run)&&this.Game.state.isFirstFrame&&this.music.play(),this.currentScene.fillRect({x:0,y:0,width:this.currentScene.width,height:this.currentScene.height,color:this.currentScene.backgroundColor}),this.loopCells(((e,t,a)=>{this.currentScene.drawImage({sprite:e.brick.sprite,x:this.cellSize*t,y:this.cellSize*a,width:this.cellSize,height:this.cellSize})})),null!==this.nextScene&&(this.nextScene.fillRect({x:0,y:0,width:this.nextScene.width,height:this.nextScene.height,color:this.nextScene.backgroundColor}),this.loopCells(((e,t,a)=>{this.nextScene.drawImage({sprite:e.brick.sprite,x:this.cellSize*t,y:this.cellSize*a,width:this.cellSize,height:this.cellSize})}),this.nextScene))}collisions(){h.passBetweenBoxesHelper(this.Game.Player),this.loopCollision((e=>{h.movingBox(this.Game.Player.hitBox,e)})),this.Game.Player.knockBackObserver.is(!0)||(this.currentScene.passages.forEach((e=>{h.simpleMovingBox(this.Game.Player.hitBox,e)?this.justReachOutPassage||this.changeWorld(!0,e.targetWorldIndex,e.targetSceneC,e.targetSceneR):this.justReachOutPassage&&(this.justReachOutPassage=!1)})),h.movingBoxLine(this.Game.Player,0,i.Up)?this.currentScene.upperEdgeCollision():h.movingBoxLine(this.Game.Player,this.Game.Viewport.height,i.Down)?this.currentScene.bottomEdgeCollision():h.movingBoxLine(this.Game.Player,0,i.Left)?this.currentScene.leftEdgeCollision():h.movingBoxLine(this.Game.Player,this.Game.Viewport.width,i.Right)&&this.currentScene.rightEdgeCollision())}slideScene(e){this.slideSceneDirection=e;let t=this.currentScene.c,a=this.currentScene.r,l=0,s=0;switch(e){case i.Left:l=-1;break;case i.Right:l=1;break;case i.Up:s=-1;break;case i.Down:s=1}if(!(t+l<0||t+l>this.currentWorld.nbCol-1||a+s<0||a+s>this.currentWorld.nbRow-1)){switch(this.nextScene=this.currentWorld.scenes[t+l][a+s],e){case i.Left:this.nextScene.x=-this.width,this.nextScene.y=0;break;case i.Right:this.nextScene.x=this.width,this.nextScene.y=0;break;case i.Up:this.nextScene.y=-this.height,this.nextScene.x=0;break;case i.Down:this.nextScene.y=this.height,this.nextScene.x=0}this.Game.Player.dx=0,this.Game.Player.dy=0,this.Game.Player.attackObserver.setNextState(!1),this.Game.useCustomLoop((()=>this.slideSceneLoop()))}}slideSceneMove(){let e=this.slideSceneAnimationSpeed*this.Game.dt;switch(this.slideSceneDirection){case i.Left:this.currentScene.x+=e,this.nextScene.x+=e;break;case i.Right:this.currentScene.x-=e,this.nextScene.x-=e;break;case i.Up:this.currentScene.y+=e,this.nextScene.y+=e;break;case i.Down:this.currentScene.y-=e,this.nextScene.y-=e}(this.nextScene.y<=0&&this.slideSceneDirection===i.Down||this.nextScene.y>=0&&this.slideSceneDirection===i.Up||this.nextScene.x<=0&&this.slideSceneDirection===i.Right||this.nextScene.x>=0&&this.slideSceneDirection===i.Left)&&(this.nextScene.y=0,this.nextScene.x=0,this.music.src!==this.nextScene.music.src&&(this.music.pause(),this.music.currentTime=0,this.music=this.nextScene.music,this.music.play()),this.currentScene.permanentItems=this.Game.ItemManager.permanentItems,this.currentScene=this.nextScene,this.nextScene=null,this.Game.EnemyManager.removeKilled(!0),this.Game.EnemyManager=new se(this.Game),this.Game.ProjectileManager.deleteAllProjectiles(),this.Game.ItemManager.deleteAllItems(),this.Game.ItemManager.permanentItems=this.currentScene.permanentItems,this.Game.state.setNextState(k.Run))}slideScenePlayerMove(){switch(this.slideSceneDirection){case i.Left:this.Game.Player.dx=this.slideSceneAnimationSpeed*this.Game.dt;break;case i.Right:this.Game.Player.dx=-this.slideSceneAnimationSpeed*this.Game.dt;break;case i.Up:this.Game.Player.dy=this.slideSceneAnimationSpeed*this.Game.dt;break;case i.Down:this.Game.Player.dy=-this.slideSceneAnimationSpeed*this.Game.dt}h.movingBoxCanvas(this.Game.Player,this),this.Game.Player.move()}slideSceneLoop(){this.slideSceneMove(),this.slideScenePlayerMove(),this.Game.drawGame()}changeWorld(e,t,a,l,i=null,s=null){this.changeWorldFromPassage=e,this.changeWorldToPassage=null!==i&&null!==s,this.targetCellC=i,this.targetCellR=s,this.nextWorld=this.Game.Map.worlds[t],this.nextScene=this.nextWorld.scenes[a][l],this.music.pause(),this.music.currentTime=0,this.music=this.nextScene.music,this.music.play(),this.currentScene.permanentItems=this.Game.ItemManager.permanentItems,this.currentWorld=this.nextWorld,this.currentScene=this.nextScene,this.nextWorld=null,this.nextScene=null,this.Game.EnemyManager.removeKilled(!0),this.Game.EnemyManager=new se(this.Game),this.Game.ProjectileManager.deleteAllProjectiles(),this.Game.ItemManager.deleteAllItems(),this.Game.ItemManager.permanentItems=this.currentScene.permanentItems,this.changeWorldToPassage?(this.Game.Player.x=this.targetCellC*this.currentScene.cellSize,this.Game.Player.y=this.targetCellR*this.currentScene.cellSize,this.targetCellC=0,this.targetCellR=0,this.justReachOutPassage=!0):(this.Game.Player.x=this.currentScene.nbCol*this.currentScene.cellSize/2-this.Game.Player.width/2,this.Game.Player.y=(this.currentScene.nbRow-1)*this.currentScene.cellSize)}drawImage({sprite:e,x:t,y:a,width:l,height:i}){this.Game.drawImage({sprite:e,x:t+this.x,y:a+this.y,width:l,height:i})}fillRect({x:e,y:t,width:a,height:l,color:i}){this.Game.fillRect({x:e+this.x,y:t+this.y,width:a,height:l,color:i})}}(g=f||(f={}))[g.Visible=0]="Visible",g[g.Hidden=1]="Hidden",g[g.ShowAnimation=2]="ShowAnimation",g[g.HideAnimation=3]="HideAnimation";class de{constructor(e){t(this,"Game"),t(this,"y"),t(this,"width"),t(this,"height"),t(this,"animationSpeed"),t(this,"state"),this.Game=e,this.y=-this.Game.Canvas.height,this.width=this.Game.Canvas.width,this.height=this.Game.Canvas.height,this.animationSpeed=12,this.state=new B(1)}move(){this.state.is(2)?this.y<0?(this.y+=this.Game.dt*this.animationSpeed,this.Game.Viewport.y+=this.Game.dt*this.animationSpeed,this.Game.Hud.y+=this.Game.dt*this.animationSpeed):(this.y=0,this.state.setNextState(0)):this.state.is(3)&&(this.y>-this.height?(this.y-=this.Game.dt*this.animationSpeed,this.Game.Viewport.y-=this.Game.dt*this.animationSpeed,this.Game.Hud.y-=this.Game.dt*this.animationSpeed):(this.y=-this.height,this.Game.Viewport.y=this.Game.Hud.height,this.Game.Hud.y=0,this.state.setNextState(1),this.Game.state.setNextState(k.Run)))}draw(){this.state.isIn(2,3)&&this.Game.drawGame(),this.fillRect({x:0,y:0,width:this.width,height:this.height,color:"#000"}),this.fillText({text:"Inventory",x:this.width/2,y:this.height/3,color:"#fff",fontSize:"24px",textAlign:"center",textBaseline:"middle"}),this.fillText({text:"Q",x:this.width/2-10,y:this.height/3*2,color:"#fff",fontSize:"24px",textAlign:"right",textBaseline:"middle"}),this.Game.Sword.isEnabled?this.drawImage({sprite:this.Game.Sword.sprites[i.Up],x:this.width/2+10,y:this.height/3*2-this.Game.Sword.swordWidth/2,width:this.Game.Sword.swordHeight,height:this.Game.Sword.swordWidth}):this.fillRect({x:this.width/2+10,y:this.height/3*2-this.Game.Sword.swordWidth/2,width:this.Game.Sword.swordHeight,height:this.Game.Sword.swordWidth,color:"grey"}),this.state.update(this.Game.dt)}drawImage({sprite:e,x:t,y:a,width:l,height:i}){this.Game.drawImage({sprite:e,x:t,y:a+this.y,width:l,height:i})}fillRect({x:e,y:t,width:a,height:l,color:i}){this.Game.fillRect({x:e,y:t+this.y,width:a,height:l,color:i})}fillText({text:e,x:t,y:a,color:l,fontSize:i="16px",textAlign:s="left",textBaseline:n="alphabetic"}){this.Game.fillText({text:e,x:t,y:a+this.y,color:l,fontSize:i,textAlign:s,textBaseline:n})}}class he extends M{constructor(e){super(),t(this,"Game"),t(this,"speed"),t(this,"movingObserver"),t(this,"attackObserver"),t(this,"diedObserver"),t(this,"diedAnimation"),t(this,"hp"),t(this,"maxHp"),t(this,"invincibleObserver"),t(this,"defaultInvincibleDuration"),t(this,"invincibleDuration"),t(this,"invincibleAnimation"),t(this,"knockBackObserver"),t(this,"knockBackSpeed"),t(this,"knockBackDuration"),t(this,"score"),t(this,"targetScore"),t(this,"obtainedItem"),t(this,"sprites",[]),t(this,"spritesAnimation"),t(this,"attackSprites",[]),t(this,"killedSprites",[]),t(this,"winSprite"),t(this,"halfHitBoxes"),t(this,"hurtSound"),t(this,"dieSound"),t(this,"lowHealthSound"),t(this,"fanfareSound"),this.Game=e,this.movingObserver=new B(!1),this.attackObserver=new B(!1),this.diedObserver=new B(!1),this.diedAnimation=new P(8,4),this.invincibleObserver=new B(!1),this.defaultInvincibleDuration=150,this.invincibleDuration=0,this.knockBackObserver=new B(!1),this.knockBackDuration=10,this.knockBackSpeed=15,this.score=0,this.targetScore=0,this.width=64,this.height=64,this.x=0,this.y=0,this.speed=5,this.maxHp=6,this.hp=this.maxHp,this.direction=i.Up,this.hitBox=new A({box:this,x:0,y:this.height/2,width:this.width,height:this.height/2}),this.halfHitBoxes=new E(this.hitBox),this.sprites[i.Up]=[],this.sprites[i.Up][1]=I.load("./sprites/png/link-up1.png"),this.sprites[i.Up][2]=I.load("./sprites/png/link-up2.png"),this.attackSprites[i.Up]=I.load("./sprites/png/link-up-attack.png"),this.sprites[i.Right]=[],this.sprites[i.Right][1]=I.load("./sprites/png/link-right1.png"),this.sprites[i.Right][2]=I.load("./sprites/png/link-right2.png"),this.attackSprites[i.Right]=I.load("./sprites/png/link-right-attack.png"),this.sprites[i.Down]=[],this.sprites[i.Down][1]=I.load("./sprites/png/link-down1.png"),this.sprites[i.Down][2]=I.load("./sprites/png/link-down2.png"),this.attackSprites[i.Down]=I.load("./sprites/png/link-down-attack.png"),this.sprites[i.Left]=[],this.sprites[i.Left][1]=I.load("./sprites/png/link-left1.png"),this.sprites[i.Left][2]=I.load("./sprites/png/link-left2.png"),this.attackSprites[i.Left]=I.load("./sprites/png/link-left-attack.png"),this.winSprite=I.load("./sprites/png/link-win.png"),this.killedSprites[1]=I.load("./sprites/png/killed1.png"),this.killedSprites[2]=I.load("./sprites/png/killed2.png"),this.spritesAnimation=new P(6,2),this.invincibleAnimation=new P(5,2),this.hurtSound=R.load("./sounds/effect/Link_Hurt.wav"),this.dieSound=R.load("./sounds/effect/Link_Die.wav"),this.lowHealthSound=R.load("./sounds/effect/Low_Health.wav",!0),this.fanfareSound=R.load("./sounds/effect/Fanfare.wav")}get isFullLife(){return this.hp===this.maxHp}draw(){let e=this.attackObserver.get()?this.attackSprites[this.direction]:this.sprites[this.direction][this.spritesAnimation.currentAnimationStep];this.invincibleObserver.get()&&(this.invincibleAnimation.update(this.Game.dt),2===this.invincibleAnimation.currentAnimationStep&&(e=new Image)),this.Game.Viewport.drawImage({sprite:e,x:this.x,y:this.y,width:this.width,height:this.height}),this.movingObserver.is(!0)&&!this.Game.state.is(k.Stopped)&&this.spritesAnimation.update(this.Game.dt)}drawWin(){this.Game.Viewport.drawImage({sprite:this.winSprite,x:this.x,y:this.y,width:this.width,height:this.height})}drawGameOver(){if(this.diedObserver.currentFrame<=125){switch(this.diedAnimation.currentAnimationStep){case 1:this.direction=i.Down;break;case 2:this.direction=i.Left;break;case 3:this.direction=i.Up;break;case 4:this.direction=i.Right}this.draw(),this.diedAnimation.update(this.Game.dt)}else if(this.diedObserver.currentFrame<=145){let e;e=this.diedObserver.currentFrame<=135?this.killedSprites[1]:this.killedSprites[2],this.Game.Viewport.currentScene.drawImage({sprite:e,x:this.x,y:this.y,width:this.width,height:this.height})}this.diedObserver.update(this.Game.dt)}move(){this.x+=this.dx,this.y+=this.dy,this.dx=0,this.dy=0}collisions(){}listenEvents(){if(this.knockBackObserver.is(!0)){switch(this.movingObserver.setNextState(!1),this.attackObserver.setNextState(!1),this.direction){case i.Up:this.dy=this.knockBackSpeed*this.Game.dt;break;case i.Right:this.dx=-this.knockBackSpeed*this.Game.dt;break;case i.Down:this.dy=-this.knockBackSpeed*this.Game.dt;break;case i.Left:this.dx=this.knockBackSpeed*this.Game.dt}h.movingBoxCanvas(this.hitBox,this.Game.Viewport)}else this.Game.Sword.isEnabled&&this.attackObserver.setNextState(this.Game.EventManager.isAttackPressed),!this.Game.EventManager.isDownPressed&&!this.Game.EventManager.isUpPressed||this.Game.EventManager.isDownPressed&&this.Game.EventManager.isUpPressed?!this.Game.EventManager.isRightPressed&&!this.Game.EventManager.isLeftPressed||this.Game.EventManager.isRightPressed&&this.Game.EventManager.isLeftPressed||(this.Game.EventManager.isRightPressed?(this.attackObserver.is(!1)&&(this.dx=this.speed*this.Game.dt),this.direction=i.Right):this.Game.EventManager.isLeftPressed&&(this.attackObserver.is(!1)&&(this.dx=-this.speed*this.Game.dt),this.direction=i.Left)):this.Game.EventManager.isDownPressed?(this.attackObserver.is(!1)&&(this.dy=this.speed*this.Game.dt),this.direction=i.Down):this.Game.EventManager.isUpPressed&&(this.attackObserver.is(!1)&&(this.dy=-this.speed*this.Game.dt),this.direction=i.Up),this.movingObserver.setNextState(0!=this.dx||0!=this.dy)}increaseScore(){this.score++,this.score>=this.targetScore&&(this.invincibleObserver.setNextState(!1),this.attackObserver.setNextState(!1),this.movingObserver.setNextState(!1),this.Game.Viewport.music.pause(),this.lowHealthSound.pause(),this.fanfareSound.play(),this.Game.state.setNextState(k.Win))}takeDamage(e){this.invincibleObserver.get()||(this.hurtSound.play(),this.takeKnockBack(),this.hp-e>=0?(this.hp-=e,this.getInvicibility()):this.hp=0,this.hp<=0?(this.diedObserver.setNextState(!1),this.invincibleObserver.setNextState(!1),this.movingObserver.setNextState(!1),this.attackObserver.setNextState(!1),this.Game.Viewport.music.pause(),this.lowHealthSound.pause(),this.dieSound.play(),this.Game.state.setNextState(k.GameOver)):this.hp<=2&&this.lowHealthSound.play())}recoverHealth(e=this.maxHp){this.hp+=e,this.hp>this.maxHp&&(this.hp=this.maxHp),this.hp>2&&(this.lowHealthSound.pause(),this.lowHealthSound.currentTime=0)}takeKnockBack(e=this.direction){this.direction=e,this.knockBackObserver.setNextState(!0)}getInvicibility(e=this.defaultInvincibleDuration){this.invincibleDuration=e,this.invincibleObserver.setNextState(!0)}getImportantItem(e){this.obtainedItem=e,this.Game.Viewport.music.pause(),this.Game.Viewport.music.currentTime=0,this.Game.useCustomLoop((()=>this.getImportantItemLoop()))}getImportantItemDraw(){this.Game.Viewport.drawImage({sprite:this.winSprite,x:this.x,y:this.y,width:this.width,height:this.height}),this.Game.Viewport.drawImage({sprite:this.obtainedItem.sprite,x:this.x,y:this.y-this.obtainedItem.height,width:this.obtainedItem.width,height:this.obtainedItem.height}),this.Game.state.currentFrame>120&&(this.Game.Viewport.music.play(),this.Game.state.setNextState(k.Run))}getImportantItemLoop(){this.Game.drawGameWithoutPlayer(),this.getImportantItemDraw()}updateObservers(){this.movingObserver.update(this.Game.dt),this.attackObserver.update(this.Game.dt),this.invincibleObserver.update(this.Game.dt),this.knockBackObserver.update(this.Game.dt),this.knockBackObserver.is(!0)&&this.knockBackObserver.currentFrame>this.knockBackDuration&&this.knockBackObserver.setNextState(!1),this.invincibleObserver.get()&&this.invincibleObserver.currentFrame>this.invincibleDuration&&this.invincibleObserver.setNextState(!1)}}class ue extends W{constructor(e){super(),t(this,"Game"),t(this,"swordWidth"),t(this,"swordHeight"),t(this,"swordHandleWidth"),t(this,"sprites",[]),t(this,"slashSound"),t(this,"flyingSound"),t(this,"isFlying"),t(this,"isEnabled"),t(this,"damage"),t(this,"hasHit"),this.Game=e,this.swordWidth=64,this.swordHeight=28,this.swordHandleWidth=16,this.sprites[i.Up]=I.load("./sprites/png/sword-up.png"),this.sprites[i.Right]=I.load("./sprites/png/sword-right.png"),this.sprites[i.Down]=I.load("./sprites/png/sword-down.png"),this.sprites[i.Left]=I.load("./sprites/png/sword-left.png"),this.slashSound=R.load("./sounds/effect/Sword_Slash.wav"),this.flyingSound=R.load("./sounds/effect/Sword_Shoot.wav"),this.isFlying=!1,this.isEnabled=!1,this.damage=1,this.hasHit=!1}get direction(){return this.Game.Player.direction}get x(){return this.direction===i.Up||this.direction===i.Down?this.Game.Player.x+(this.Game.Player.width-this.swordHeight)/2:this.direction===i.Left?this.Game.Player.x-this.swordWidth+this.swordHandleWidth:this.Game.Player.x+this.Game.Player.width-this.swordHandleWidth}get y(){return this.direction===i.Up?this.Game.Player.y-this.swordWidth+this.swordHandleWidth:this.direction===i.Down?this.Game.Player.y+this.Game.Player.width-this.swordHandleWidth:(this.direction,i.Left,this.Game.Player.y+(this.Game.Player.height-this.swordHeight)/2)}get width(){return this.direction===i.Up||this.direction===i.Down?this.swordHeight:this.swordWidth}get height(){return this.direction===i.Up||this.direction===i.Down?this.swordWidth:this.swordHeight}draw(){this.isEnabled&&this.Game.Player.attackObserver.get()&&this.Game.Viewport.drawImage({sprite:this.sprites[this.direction],x:this.x,y:this.y,width:this.width,height:this.height})}drawWin(){this.Game.Viewport.drawImage({sprite:this.sprites[i.Up],x:this.Game.Player.x,y:this.Game.Player.y-this.swordWidth,width:this.swordHeight,height:this.swordWidth})}collisions(){this.isEnabled&&this.Game.Player.attackObserver.get()&&this.Game.EnemyManager.loopEnemies((e=>{h.simpleMovingBox(e.hitBox,this)&&(e.takeDamage(this.damage),this.hasHit=!0)}))}listenEvents(){this.isEnabled&&(this.Game.Player.attackObserver.get()&&this.Game.Player.attackObserver.isFirstFrame&&(this.slashSound.play(),this.hasHit=!1),this.isFlying||!this.Game.Player.attackObserver.getLastFrame()||this.Game.Player.attackObserver.get()||this.hasHit||!this.Game.Player.isFullLife||(this.flyingSound.play(),this.isFlying=!0,this.Game.ProjectileManager.addProjectile(new z(this.Game,this.x,this.y,3*this.Game.Player.speed,this.direction,this.damage))))}}class re{constructor(e){t(this,"Game"),t(this,"projectiles"),t(this,"shieldSound"),this.Game=e,this.projectiles=[],this.shieldSound=R.load("./sounds/effect/Shield.wav")}collisions(){this.loopProjectiles((e=>{if(!e.state.is(u.ShieldBlocked)){if(e.hasEnemiesCollision&&this.Game.EnemyManager.loopEnemies((t=>{h.movingBoxs(t,e.hitBox)&&(null!==e.enemiesCollisionCallback&&e.enemiesCollisionCallback(t),this.deleteProjectile(e))})),e.hasPlayerCollision&&h.movingBoxs(this.Game.Player.hitBox,e.hitBox)){if(e.canBeShieldBlocked&&this.Game.Player.movingObserver.is(!1)&&this.Game.Player.attackObserver.is(!1)&&i.areOpposite(this.Game.Player.direction,e.direction))return this.shieldSound.play(),void e.state.setNextState(u.ShieldBlocked);null!==e.playerCollisionCallback&&e.playerCollisionCallback(),this.deleteProjectile(e)}h.movingBoxCanvas(e.hitBox,this.Game.Viewport)&&this.deleteProjectile(e)}}))}move(){this.loopProjectiles((e=>{switch(e.state.get()){case u.Moving:e.x+=e.dx*this.Game.dt,e.y+=e.dy*this.Game.dt;break;case u.ShieldBlocked:i.isVertical(e.direction)?(e.x+=e.dy/2*this.Game.dt,e.y-=e.dy/2*this.Game.dt):(e.x-=e.dx/2*this.Game.dt,e.y+=e.dx/2*this.Game.dt)}}))}draw(){this.loopProjectiles((e=>{this.Game.Viewport.currentScene.drawImage({sprite:e.sprites[e.direction],x:e.x,y:e.y,width:e.width,height:e.height})}))}updateObservers(){this.loopProjectiles((e=>{e.state.update(this.Game.dt),e.state.is(u.ShieldBlocked)&&e.state.currentFrame>20&&this.deleteProjectile(e)}))}addProjectile(e){this.projectiles.push(e)}deleteProjectile(e){null!==e.deleteCallback&&e.deleteCallback(),this.projectiles.splice(this.projectiles.indexOf(e),1)}deleteAllProjectiles(){this.loopProjectiles((e=>{null!==e.deleteCallback&&e.deleteCallback()})),this.projectiles=[]}loopProjectiles(e){this.projectiles.forEach((t=>{e(t)}))}}class oe{constructor(e){t(this,"Game"),t(this,"items"),t(this,"permanentItems"),this.Game=e,this.items=[],this.permanentItems=[]}collisions(){this.loopItems((e=>{(h.simpleMovingBox(this.Game.Player,e)||this.Game.Player.attackObserver.is(!0)&&h.simpleBox(this.Game.Sword,e))&&(e.collisionCallback(),e.collisionSound.play(),this.deleteItem(e))}))}draw(){this.loopItems((e=>{this.Game.Viewport.currentScene.drawImage({sprite:e.sprite,x:e.x,y:e.y,width:e.width,height:e.height})}))}addItem(e){this.items.push(e)}addPermanentItem(e){this.permanentItems.push(e)}deleteItem(e){let t=this.items.indexOf(e),a=this.permanentItems.indexOf(e);t>-1?this.items.splice(t,1):a>-1&&this.permanentItems.splice(a,1)}deleteAllItems(){this.items=[],this.permanentItems=[]}loopItems(e){this.items.forEach((t=>{e(t)})),this.permanentItems.forEach((t=>{e(t)}))}}class we{constructor(e){t(this,"Game"),t(this,"isRightPressed",!1),t(this,"isLeftPressed",!1),t(this,"isUpPressed",!1),t(this,"isDownPressed",!1),t(this,"isAttackPressed",!1),t(this,"isEnterPressed",!1),t(this,"currentAttackFrame",0),t(this,"attackDuration",10),this.Game=e,document.addEventListener("keydown",(e=>this.keyEvent(e,!0))),document.addEventListener("keyup",(e=>this.keyEvent(e,!1))),document.addEventListener("visibilitychange",(()=>this.visibilityEvent()),!1)}keyEvent(e,t){if(e.repeat)e.preventDefault();else{switch(e.key){case"ArrowRight":this.isRightPressed=t;break;case"ArrowLeft":this.isLeftPressed=t;break;case"ArrowUp":this.isUpPressed=t;break;case"ArrowDown":this.isDownPressed=t;break;case"Enter":this.isEnterPressed=t;break;case"q":case"Q":t&&(this.isAttackPressed=!0);break;case"i":case"I":if(!t)return;this.Game.state.isIn(k.Run)&&this.Game.Panes.isAnimationFinished?(this.Game.state.setNextState(k.Inventory),this.Game.Inventory.state.set(f.ShowAnimation)):this.Game.state.isIn(k.Inventory)&&(this.Game.Inventory.state.is(f.Visible)?this.Game.Inventory.state.setNextState(f.HideAnimation):this.Game.Inventory.state.set(this.Game.Inventory.state.is(f.ShowAnimation)?f.HideAnimation:f.ShowAnimation));break;case"w":case"W":this.Game.state.setNextState(k.Win);break;case"p":case"P":if(!t)return;this.Game.state.isIn(k.Run,k.Stopped)&&this.Game.state.setNextState(this.Game.state.is(k.Run)?k.Stopped:k.Run)}e.preventDefault()}}visibilityEvent(){document.hidden&&this.Game.state.is(k.Run)&&(this.Game.state.setNextState(k.Stopped),this.Game.lastTime=null)}newFrame(){if(this.isAttackPressed)return this.currentAttackFrame+=this.Game.dt,void(this.currentAttackFrame>=this.attackDuration&&(this.isAttackPressed=!1));this.currentAttackFrame=0}}class fe{constructor(e){t(this,"Game"),t(this,"x"),t(this,"y"),t(this,"height"),t(this,"width"),t(this,"emptyHeartSprite"),t(this,"halfHeartSprite"),t(this,"fullHeartSprite"),t(this,"currentSceneAnimation"),this.Game=e,this.x=0,this.y=0,this.height=64,this.emptyHeartSprite=I.load("./sprites/png/empty-heart.png"),this.halfHeartSprite=I.load("./sprites/png/half-heart.png"),this.fullHeartSprite=I.load("./sprites/png/full-heart.png"),this.currentSceneAnimation=new P(25,2)}draw(){this.fillRect({x:0,y:0,width:this.width,height:this.height,color:"#000"}),this.drawHearts(),this.drawMap(),this.drawScore()}drawHearts(){for(let e=1;e<=this.Game.Player.maxHp/2;e++)this.drawImage({sprite:this.emptyHeartSprite,x:24*e+8*e,y:this.height/2-12,width:24,height:24});for(let e=1;e<=this.Game.Player.hp/2;e++)this.drawImage({sprite:this.fullHeartSprite,x:24*e+8*e,y:this.height/2-12,width:24,height:24});this.Game.Player.hp%2==1&&this.drawImage({sprite:this.halfHeartSprite,x:24*(this.Game.Player.hp/2+1)+8*(this.Game.Player.hp/2-1),y:this.height/2-12,width:24,height:24})}drawMap(){let e=(this.height-this.Game.Viewport.currentWorld.nbRow-1)/this.Game.Viewport.currentWorld.nbRow,t=e*this.Game.Viewport.width/this.Game.Viewport.height,a=(this.width-t*this.Game.Viewport.currentWorld.nbCol+this.Game.Viewport.currentWorld.nbCol-1)/2;this.Game.Viewport.currentWorld.loopScenes((l=>{let i="#00a230";l.hasPermanentItems?i="#e2d64a":l.hasEnemies&&(i="#d11c0d"),this.fillRect({x:a+t*l.c+2*l.c,y:e*l.r+2*l.r,width:t,height:e,color:i})})),this.Game.state.isIn(k.Run)&&(1===this.currentSceneAnimation.currentAnimationStep&&this.fillRect({x:a+t*this.Game.Viewport.currentScene.c+2*this.Game.Viewport.currentScene.c,y:e*this.Game.Viewport.currentScene.r+2*this.Game.Viewport.currentScene.r,width:t,height:e,color:"rgba(0, 0, 0, 0.3)"}),this.currentSceneAnimation.update(this.Game.dt))}drawScore(){this.fillText({text:" SCORE: "+this.Game.Player.score+"/"+this.Game.Player.targetScore,x:this.width-this.height/2,y:this.height/2,color:"#fff",textAlign:"right",textBaseline:"middle"})}drawImage({sprite:e,x:t,y:a,width:l,height:i}){this.Game.drawImage({sprite:e,x:t+this.x,y:a+this.y,width:l,height:i})}fillRect({x:e,y:t,width:a,height:l,color:i}){this.Game.fillRect({x:e+this.x,y:t+this.y,width:a,height:l,color:i})}fillText({text:e,x:t,y:a,color:l,fontSize:i="16px",textAlign:s="left",textBaseline:n="alphabetic"}){this.Game.fillText({text:e,x:t+this.x,y:a+this.y,color:l,fontSize:i,textAlign:s,textBaseline:n})}}class ge{constructor(e){t(this,"Game"),t(this,"speed"),t(this,"position"),this.Game=e,this.speed=8,this.position=0}get isAnimationFinished(){return this.position>this.Game.Canvas.width/2}reset(){this.position=0}drawOpen(){this.Game.fillRect({x:-this.position,y:0,width:this.Game.Canvas.width/2,height:this.Game.Canvas.height,color:"#000"}),this.Game.fillRect({x:this.Game.Canvas.width/2+this.position,y:0,width:this.Game.Canvas.width/2,height:this.Game.Canvas.height,color:"#000"}),this.position+=this.speed*this.Game.dt}drawClose(){this.Game.fillRect({x:-this.Game.Canvas.width/2+this.position,y:0,width:this.Game.Canvas.width/2,height:this.Game.Canvas.height,color:"#000"}),this.Game.fillRect({x:this.Game.Canvas.width-this.position,y:0,width:this.Game.Canvas.width/2,height:this.Game.Canvas.height,color:"#000"}),this.position+=this.speed*this.Game.dt}}class ce{constructor(e,a,l,i,s,n=0){t(this,"Game"),t(this,"title"),t(this,"message"),t(this,"showMessageAfter"),t(this,"backgroundColor"),t(this,"state"),t(this,"messageAnimation"),this.Game=e,this.title=i,this.message=s,this.showMessageAfter=n,this.backgroundColor=l,this.state=a,this.messageAnimation=new P(50,2)}draw(){this.Game.fillRect({x:0,y:0,width:this.Game.Canvas.width,height:this.Game.Canvas.height,color:this.backgroundColor}),this.Game.fillText({text:this.title,x:this.Game.Canvas.width/2,y:this.Game.Canvas.height/3,color:"#fff",fontSize:"24px",textAlign:"center",textBaseline:"middle"}),this.state.currentFrame>this.showMessageAfter&&(1===this.messageAnimation.currentAnimationStep&&this.Game.fillText({text:this.message,x:this.Game.Canvas.width/2,y:this.Game.Canvas.height/3*2,color:"#fff",fontSize:"16px",textAlign:"center",textBaseline:"middle"}),this.messageAnimation.update(this.Game.dt))}updateObservers(){this.state.update(this.Game.dt)}}(p=c||(c={}))[p.BlackScreen=0]="BlackScreen";class pe extends ce{constructor(e){super(e,new B(0),"#000","TLOZ-JS GAME","press enter to start",150),t(this,"music"),this.music=R.load("./sounds/music/intro.mp3",!0)}draw(){switch(this.state.get()){case 0:this.state.isFirstFrame&&this.music.play(),super.draw(),this.state.currentFrame>this.showMessageAfter&&this.Game.EventManager.isEnterPressed&&(this.music.pause(),this.Game.state.setNextState(k.Run))}super.updateObservers()}}(x=m||(m={}))[x.PlayerAnimation=0]="PlayerAnimation",x[x.HideGame=1]="HideGame",x[x.BlackScreen=2]="BlackScreen";class me extends ce{constructor(e){super(e,new B(0),"#000","GAME OVER","press enter to retry",150),t(this,"music"),this.music=R.load("./sounds/music/game_over.mp3",!0)}draw(){switch(this.state.get()){case 0:this.Game.Viewport.draw(),this.Game.EnemyManager.draw(),this.Game.Hud.draw(),this.Game.Player.drawGameOver(),this.Game.Player.diedObserver.currentFrame>145&&this.state.setNextState(1);break;case 1:this.state.isFirstFrame&&this.Game.Panes.reset(),this.Game.Viewport.draw(),this.Game.Hud.draw(),this.Game.Panes.drawClose(),this.Game.Panes.isAnimationFinished&&this.state.setNextState(2);break;case 2:this.state.isFirstFrame&&this.music.play(),this.Game.EventManager.isEnterPressed&&(this.music.pause(),this.Game.restart()),super.draw()}super.updateObservers()}}(G=y||(y={}))[G.PlayerAnimation=0]="PlayerAnimation",G[G.HideGame=1]="HideGame",G[G.BlackScreen=2]="BlackScreen";class xe extends ce{constructor(e){super(e,new B(0),"#000","YOU WON","press enter to play again",150),t(this,"music"),t(this,"killedSprites",[]),this.music=R.load("./sounds/music/ending.mp3",!0),this.killedSprites[1]=I.load("./sprites/png/killed1.png"),this.killedSprites[2]=I.load("./sprites/png/killed2.png")}draw(){switch(this.state.get()){case 0:this.Game.Viewport.draw(),this.Game.EnemyManager.draw(),this.Game.Sword.drawWin(),this.Game.Player.drawWin(),this.Game.Hud.draw(),this.state.currentFrame>120&&this.state.setNextState(1);break;case 1:this.state.isFirstFrame&&this.Game.Panes.reset(),this.Game.Viewport.draw(),this.Game.EnemyManager.draw(),this.Game.Sword.drawWin(),this.Game.Player.drawWin(),this.Game.Hud.draw(),this.Game.Panes.drawClose(),this.Game.Panes.isAnimationFinished&&this.state.setNextState(2);break;case 2:this.state.isFirstFrame&&this.music.play(),this.Game.EventManager.isEnterPressed&&(this.music.pause(),this.Game.restart()),super.draw()}super.updateObservers()}}(b=S||(S={}))[b.BlackScreen=0]="BlackScreen";class ye extends ce{constructor(e){super(e,new B(0),"rgba(0, 0, 0, 0.5)","PAUSE","press p to continue")}draw(){switch(this.state.get()){case 0:super.draw()}super.updateObservers()}}(v=k||(k={}))[v.Splash=0]="Splash",v[v.Run=1]="Run",v[v.Inventory=2]="Inventory",v[v.Stopped=3]="Stopped",v[v.CustomLoop=4]="CustomLoop",v[v.GameOver=5]="GameOver",v[v.Win=6]="Win";class Ge{constructor(e){t(this,"Canvas"),t(this,"ctx"),t(this,"lastTime"),t(this,"dt"),t(this,"BrickCollection"),t(this,"Map"),t(this,"Viewport"),t(this,"Player"),t(this,"Sword"),t(this,"EnemyManager"),t(this,"ProjectileManager"),t(this,"ItemManager"),t(this,"EventManager"),t(this,"Hud"),t(this,"Panes"),t(this,"SplashScreen"),t(this,"GameOverScreen"),t(this,"WinScreen"),t(this,"StoppedScreen"),t(this,"Inventory"),t(this,"state"),t(this,"customLoop"),this.Canvas=e,this.ctx=this.Canvas.getContext("2d"),this.init()}init(){this.EventManager=new we(this),this.BrickCollection=new L(this),this.Map=new ie(this),this.Viewport=new ne(this),this.Player=new he(this),this.Sword=new ue(this),this.EnemyManager=new se(this),this.ProjectileManager=new re(this),this.ItemManager=new oe(this),this.Hud=new fe(this),this.Panes=new ge(this),this.SplashScreen=new pe(this),this.GameOverScreen=new me(this),this.WinScreen=new xe(this),this.StoppedScreen=new ye(this),this.Viewport.y=this.Hud.height,this.Hud.width=this.Viewport.width,this.Canvas.width=this.Viewport.width,this.Canvas.height=this.Viewport.height+this.Hud.height,this.Inventory=new de(this),this.Player.x=this.Viewport.cellSize*this.Map.spawnCellColl,this.Player.y=this.Viewport.cellSize*this.Map.spawnCellRow,this.Map.loopWorlds((e=>{e.loopScenes((e=>{e.hasEnemies&&this.Player.targetScore++}))})),this.state=new B(0),this.lastTime=null,this.dt=null}restart(){this.init(),this.state.setNextState(1)}run(){window.requestAnimationFrame((e=>this.loop(e)))}deltaCalculation(e){null===this.lastTime?this.dt=1:this.dt=(e-this.lastTime)/(1e3/60),this.lastTime=e}loop(e){switch(window.requestAnimationFrame((e=>this.loop(e))),this.deltaCalculation(e),this.ctx.clearRect(0,0,this.Canvas.width,this.Canvas.height),this.state.get()){case 0:this.splashLoop();break;case 1:this.runLoop();break;case 2:this.inventoryLoop();break;case 3:this.stoppedLoop();break;case 5:this.gameOverLoop();break;case 6:this.winLoop();break;case 4:this.customLoop()}this.state.update(this.dt)}runLoop(){if(!this.Panes.isAnimationFinished)return this.drawGame(),void this.Panes.drawOpen();this.Player.listenEvents(),this.Sword.listenEvents(),this.EnemyManager.aiThinking(),this.Sword.collisions(),this.Player.collisions(),this.ItemManager.collisions(),this.EnemyManager.collisions(),this.ProjectileManager.collisions(),this.Viewport.collisions(),this.Player.move(),this.EnemyManager.move(),this.ProjectileManager.move(),this.drawGame(),this.EnemyManager.removeKilled(),this.Player.updateObservers(),this.EnemyManager.updateObservers(),this.ProjectileManager.updateObservers(),this.EventManager.newFrame()}inventoryLoop(){this.Inventory.move(),this.Inventory.draw()}stoppedLoop(){this.drawGame(),this.StoppedScreen.draw()}splashLoop(){this.SplashScreen.draw()}gameOverLoop(){this.GameOverScreen.draw()}useCustomLoop(e){this.state.setNextState(4),this.customLoop=e}winLoop(){console.log("winLoop"),document.dispatchEvent(new Event("win")),this.WinScreen.draw()}drawGame(){this.Viewport.draw(),this.EnemyManager.draw(),this.Sword.draw(),this.ItemManager.draw(),this.ProjectileManager.draw(),this.Player.draw(),this.Hud.draw()}drawGameWithoutPlayer(){this.Viewport.draw(),this.EnemyManager.draw(),this.Sword.draw(),this.ItemManager.draw(),this.ProjectileManager.draw(),this.Hud.draw()}drawImage({sprite:e,x:t,y:a,width:l,height:i}){this.ctx.beginPath(),this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(e,t,a,l,i),this.ctx.closePath()}fillRect({x:e,y:t,width:a,height:l,color:i}){this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.fillRect(e,t,a,l),this.ctx.closePath()}fillText({text:e,x:t,y:a,color:l,fontSize:i="16px",textAlign:s="left",textBaseline:n="alphabetic"}){this.ctx.beginPath(),this.ctx.font=i+" NES-font",this.ctx.fillStyle=l,this.ctx.textAlign=s,this.ctx.textBaseline=n,this.ctx.fillText(e,t,a),this.ctx.closePath()}}let Se=document.getElementById("startButton"),be=document.getElementById("canvas");Se.addEventListener("click",(()=>{new Ge(be).run(),Se.remove()}));
