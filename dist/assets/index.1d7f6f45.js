var e=Object.defineProperty,t=(t,l,a)=>(((t,l,a)=>{l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a})(t,"symbol"!=typeof l?l+"":l,a),a);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var l,a,i,s,n,d,h,u,r,o,w,f,g,c,p,m,x,G,S,b,y,k,v;class C{constructor(){t(this,"currentFrame"),t(this,"isFirstFrame"),this.currentFrame=0,this.isFirstFrame=!0}update(e){this.currentFrame+=e}}class P extends C{constructor(e){super(),t(this,"lastState"),t(this,"lastFrameState"),t(this,"state"),t(this,"nextState"),this.lastState=null,this.lastFrameState=null,this.state=e,this.nextState=null}set(e){this.lastState=this.state,this.state=e,this.nextState=null,this.currentFrame=0,this.isFirstFrame=!0}setNextState(e){this.nextState=e}update(e){this.lastFrameState=this.state,null!==this.nextState?this.set(this.nextState):this.isFirstFrame=!1,super.update(e)}get(){return this.state}getLast(){return this.lastState}getLastFrame(){return this.lastFrameState}is(e){return this.state===e}isIn(...e){return e.some((e=>this.is(e)))}was(e){return this.lastState===e}wasIn(...e){return e.some((e=>this.was(e)))}wasLastFrame(e){return this.lastFrameState===e}wasInLastFrame(...e){return e.some((e=>this.wasLastFrame(e)))}}class I extends C{constructor(e,l){super(),t(this,"animationStepDuration"),t(this,"currentAnimationStep",1),t(this,"nbAnimationStep"),this.animationStepDuration=e,this.nbAnimationStep=l}update(e){this.currentFrame>=this.animationStepDuration?(this.currentFrame=0,this.currentAnimationStep=this.currentAnimationStep+1>this.nbAnimationStep?1:this.currentAnimationStep+1,this.isFirstFrame=!0):this.isFirstFrame=!1,super.update(e)}}class B{static load(e){let t=new Image;return t.src=e,t}}class R{static load(e,t=!1){let l=new Audio(e);return l.loop=t,l}}class O{constructor(e){t(this,"Game"),t(this,"_sprite"),t(this,"hasCollisions"),this.Game=e,this.hasCollisions=!1}get sprite(){return this._sprite}set sprite(e){this._sprite=e}}class D extends O{constructor(e){super(e),t(this,"sprites",[]),t(this,"spritesAnimation")}}class L{constructor(e){t(this,"Game"),this.Game=e}get(e){switch(e){case"passage":return new l.Passage(this.Game);case"default":return new l.Default(this.Game);case"default-dungeon":return new l.DefaultDungeon(this.Game);case"stairs":return new l.Stairs(this.Game);case"tree":return new l.Tree(this.Game);case"white-tree":return new l.WhiteTree(this.Game);case"grave":return new l.Grave(this.Game);case"wall":return new l.Wall(this.Game);case"wall-dungeon":return new l.WallDungeon(this.Game);case"red-wall":return new l.RedWall(this.Game);case"single-wall":return new l.SingleWall(this.Game);case"single-red-wall":return new l.SingleRedWall(this.Game);case"wall-t":return new l.WallTop(this.Game);case"wall-tr":return new l.WallTopRight(this.Game);case"wall-tl":return new l.WallTopLeft(this.Game);case"wall-br":return new l.WallBottomRight(this.Game);case"wall-bl":return new l.WallBottomLeft(this.Game);case"white-wall":return new l.WhiteWall(this.Game);case"white-wall-t":return new l.WhiteWallTop(this.Game);case"white-wall-tr":return new l.WhiteWallTopRight(this.Game);case"white-wall-tl":return new l.WhiteWallTopLeft(this.Game);case"white-wall-br":return new l.WhiteWallBottomRight(this.Game);case"white-wall-bl":return new l.WhiteWallBottomLeft(this.Game);case"monument-tr":return new l.MonumentTopRight(this.Game);case"monument-tl":return new l.MonumentTopLeft(this.Game);case"monument-br":return new l.MonumentBottomRight(this.Game);case"monument-bl":return new l.MonumentBottomLeft(this.Game);case"fire":return new l.Fire(this.Game);default:throw"Brick "+e+" not found"}}}!function(e){e.Passage=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/passage.png")}};e.Default=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/default.png")}};e.DefaultDungeon=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/default-dungeon.png")}};e.Stairs=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/stairs.png")}};e.Tree=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/tree.png"),this.hasCollisions=!0}};e.WhiteTree=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/white-tree.png"),this.hasCollisions=!0}};e.Grave=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/grave.png"),this.hasCollisions=!0}};e.Wall=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/wall.png"),this.hasCollisions=!0}};e.WallDungeon=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/wall-dungeon.png"),this.hasCollisions=!0}};e.RedWall=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/red-wall.png"),this.hasCollisions=!0}};e.SingleWall=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/single-wall.png"),this.hasCollisions=!0}};e.SingleRedWall=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/single-red-wall.png"),this.hasCollisions=!0}};e.WallTop=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/wall-top.png"),this.hasCollisions=!0}};e.WallTopRight=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/wall-top-right.png"),this.hasCollisions=!0}};e.WallTopLeft=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/wall-top-left.png"),this.hasCollisions=!0}};e.WallBottomRight=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/wall-bottom-right.png"),this.hasCollisions=!0}};e.WallBottomLeft=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/wall-bottom-left.png"),this.hasCollisions=!0}};e.WhiteWall=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/white-wall.png"),this.hasCollisions=!0}};e.WhiteWallTop=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/white-wall-top.png"),this.hasCollisions=!0}};e.WhiteWallTopRight=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/white-wall-top-right.png"),this.hasCollisions=!0}};e.WhiteWallTopLeft=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/white-wall-top-left.png"),this.hasCollisions=!0}};e.WhiteWallBottomRight=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/white-wall-bottom-right.png"),this.hasCollisions=!0}};e.WhiteWallBottomLeft=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/white-wall-bottom-left.png"),this.hasCollisions=!0}};e.MonumentTopRight=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/monument-top-right.png"),this.hasCollisions=!0}};e.MonumentTopLeft=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/monument-top-left.png"),this.hasCollisions=!0}};e.MonumentBottomRight=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/monument-bottom-right.png"),this.hasCollisions=!0}};e.MonumentBottomLeft=class extends O{constructor(e){super(e),this.sprite=B.load("/sprites/png/bricks/monument-bottom-left.png"),this.hasCollisions=!0}};e.Fire=class extends D{constructor(e){super(e),this.hasCollisions=!0,this.sprites[1]=B.load("/sprites/png/bricks/fire1.png"),this.sprites[2]=B.load("/sprites/png/bricks/fire2.png"),this.spritesAnimation=new I(10,2)}get sprite(){let e=this.sprites[this.spritesAnimation.currentAnimationStep];return this.spritesAnimation.update(this.Game.dt),e}}}(l||(l={})),(i=a||(a={})).trunc=function(e,t=0){return t=Math.trunc(t),Math.trunc(e*10**t)/10**t},i.round=function(e,t=0){return t=Math.trunc(t),Math.round(e*10**t)/10**t};class W{constructor(){t(this,"_x"),t(this,"_y"),t(this,"_width"),t(this,"_height")}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get x(){return this._x}set x(e){this._x=a.round(e,7)}get y(){return this._y}set y(e){this._y=a.round(e,7)}}class M extends W{constructor(){super(),t(this,"_dx",0),t(this,"_dy",0),t(this,"_direction"),t(this,"_hitBox"),this.hitBox=this}get dx(){return this._dx}set dx(e){this._dx=e}get dy(){return this._dy}set dy(e){this._dy=e}get direction(){return this._direction}set direction(e){this._direction=e}get hitBox(){return this._hitBox}set hitBox(e){this._hitBox=e}}class E{constructor(e,l,a,i,s){t(this,"_Box"),t(this,"_hitX"),t(this,"_hitY"),t(this,"_hitWidth"),t(this,"_hitHeight"),this._Box=e,this._hitX=l,this._hitY=a,this._hitWidth=i,this._hitHeight=s}get x(){return this._Box.x+this._hitX}set x(e){this._Box.x=e-this._hitX}get y(){return this._Box.y+this._hitY}set y(e){this._Box.y=e-this._hitY}get width(){return this._hitWidth}get height(){return this._hitHeight}get dx(){return this._Box.dx}set dx(e){this._Box.dx=e}get dy(){return this._Box.dy}set dy(e){this._Box.dy=e}get direction(){return this._Box.direction}set direction(e){this._Box.direction=e}}class A{constructor(e){t(this,"box"),t(this,"halfLeftHitBox"),t(this,"halfRightHitBox"),t(this,"halfUpHitBox"),t(this,"halfDownHitBox"),this.box=e,this.halfLeftHitBox=new E(this.box,0,0,this.box.width/2,this.box.height),this.halfRightHitBox=new E(this.box,this.box.width/2,0,this.box.width/2,this.box.height),this.halfUpHitBox=new E(this.box,0,0,this.box.width,this.box.height/2),this.halfDownHitBox=new E(this.box,0,this.box.height/2,this.box.width,this.box.height/2)}}!function(e){function t(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}e.getIntInclusive=t,e.getOneInt=function(e){return 1===t(1,e)}}(s||(s={})),(d=n||(n={}))[d.Up=0]="Up",d[d.Right=1]="Right",d[d.Down=2]="Down",d[d.Left=3]="Left",function(e){e.getRandom=function(){switch(s.getIntInclusive(1,4)){case 1:return e.Up;case 2:return e.Right;case 3:return e.Down;case 4:default:return e.Left}},e.getOpposite=function(t){switch(t){case e.Up:return e.Down;case e.Down:return e.Up;case e.Left:return e.Right;case e.Right:default:return e.Left}},e.areOpposite=function(t,l){return t===e.Up&&l===e.Down||t===e.Down&&l===e.Up||t===e.Right&&l===e.Left||t===e.Left&&l===e.Right},e.isVertical=function(t){switch(t){case e.Up:case e.Down:return!0;case e.Left:case e.Right:default:return!1}},e.isHorizontal=function(t){switch(t){case e.Up:case e.Down:return!0;case e.Left:case e.Right:default:return!1}}}(n||(n={})),function(e){function t(e,t){return!(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)}function l(e,l){let a={x:e.x,y:e.y,width:e.width,height:e.height};return e.dx>0?a.width+=e.dx:e.dx<0&&(a.x-=Math.abs(e.dx),a.width+=Math.abs(e.dx)),e.dy>0?a.height+=e.dy:e.dy<0&&(a.y-=Math.abs(e.dy),a.height+=Math.abs(e.dy)),t(a,l)}function a(e,t){return!(e.x+e.dx+e.width<=t.width&&e.x+e.dx>=0&&e.y+e.dy+e.height<=t.height&&e.y+e.dy>=0)}function i(e,t,l){switch(l){case n.Up:if(e.y+e.dy<t)return!0;break;case n.Down:if(e.y+e.dy+e.height>t)return!0;break;case n.Left:if(e.x+e.dx<t)return!0;break;case n.Right:if(e.x+e.dx+e.width>t)return!0}return!1}e.simpleBox=t,e.simpleMovingBox=l,e.movingBox=function(e,t){return!!l(e,t)&&(e.dx>0&&e.x+e.width<=t.x?e.dx=t.x-(e.x+e.width):e.dx<0&&e.x>=t.x+t.width&&(e.dx=t.x+t.width-e.x),e.dy>0&&e.y+e.height<=t.y?e.dy=t.y-(e.y+e.height):e.dy<0&&e.y>=t.y+t.height&&(e.dy=t.y+t.height-e.y),!0)},e.movingBoxs=function(e,t){return!(e.x+e.dx>=t.x+t.width+e.dx||e.x+e.dx+e.width<=t.x+e.dx||e.y+e.dy>=t.y+t.height+e.dy||e.y+e.dy+e.height<=t.y+e.dy)},e.simpleMovingBoxCanvas=a,e.movingBoxCanvas=function(e,t){return!!a(e,t)&&(e.x+e.dx+e.width>t.width&&(e.dx=0,e.x=t.width-e.width),e.x+e.dx<0&&(e.dx=0,e.x=0),e.y+e.dy+e.height>t.height&&(e.dy=0,e.y=t.height-e.height),e.y+e.dy<0&&(e.dy=0,e.y=0),!0)},e.simpleMovingBoxLine=i,e.movingBoxLine=function(e,t,l){if(i(e,t,l)){switch(l){case n.Up:e.y=t+1,e.dy=0;break;case n.Down:e.y=t-e.height,e.dy=0;break;case n.Left:e.x=t+1,e.dx=0;break;case n.Right:e.x=t-e.width,e.dx=0}return!0}return!1},e.passBetweenBoxesHelper=function(t){let l=!1,a=!1,i=!1,s=!1;if(t.Game.Viewport.loopCollision((n=>{e.simpleMovingBox(t.hitBox,n)&&(e.simpleMovingBox(t.halfHitBoxes.halfLeftHitBox,n)&&(l=!0),e.simpleMovingBox(t.halfHitBoxes.halfRightHitBox,n)&&(a=!0),e.simpleMovingBox(t.halfHitBoxes.halfUpHitBox,n)&&(i=!0),e.simpleMovingBox(t.halfHitBoxes.halfDownHitBox,n)&&(s=!0))})),t.direction===n.Up||t.direction===n.Down){if(l&&!a)return t.dx=t.speed*t.Game.dt,!0;if(!l&&a)return t.dx=-t.speed*t.Game.dt,!0}else if(t.direction===n.Left||t.direction===n.Right){if(i&&!s)return t.dy=t.speed*t.Game.dt,!0;if(!i&&s)return t.dy=-t.speed*t.Game.dt,!0}return!1}}(h||(h={}));class H extends W{constructor(){super(),t(this,"Game"),t(this,"sprite"),t(this,"collisionSound")}collisionCallback(){}}class F extends H{constructor(e,t,l){super(),this.Game=e,this.x=t,this.y=l,this.width=24,this.height=24,this.sprite=B.load("/sprites/png/full-heart.png"),this.collisionSound=R.load("/sounds/effect/Get_Heart.wav")}collisionCallback(){this.Game.Player.recoverHealth(2)}}class V extends H{constructor(e,t,l){super(),this.Game=e,this.x=t,this.y=l,this.width=32,this.height=32,this.sprite=B.load("/sprites/png/clock.png"),this.collisionSound=R.load("/sounds/effect/Get_Item.wav")}collisionCallback(){this.Game.Player.getInvicibility(400)}}class U extends H{constructor(e,t,l){super(),this.Game=e,this.x=t,this.y=l,this.width=28,this.height=64,this.sprite=B.load("/sprites/png/sword-up.png"),this.collisionSound=R.load("/sounds/effect/Fanfare.wav")}collisionCallback(){this.Game.Player.getImportantItem(this),this.Game.Sword.isEnabled=!0}}class _ extends H{constructor(e,t,l){super(),this.Game=e,this.x=t,this.y=l,this.width=26,this.height=26,this.sprite=B.load("/sprites/png/heart-receptacle.png"),this.collisionSound=R.load("/sounds/effect/Fanfare.wav")}collisionCallback(){this.Game.Player.getImportantItem(this),this.Game.Player.maxHp+=2,this.Game.Player.recoverHealth()}}(r=u||(u={}))[r.Moving=0]="Moving",r[r.ShieldBlocked=1]="ShieldBlocked";class N extends M{constructor(e,l){switch(super(),t(this,"Game"),t(this,"speed"),t(this,"damage"),t(this,"sprites"),t(this,"hasPlayerCollision"),t(this,"canBeShieldBlocked"),t(this,"hasEnemiesCollision"),t(this,"state"),this.speed=e,this.direction=l,this.direction){case n.Up:this.dy=-this.speed;break;case n.Right:this.dx=this.speed;break;case n.Down:this.dy=this.speed;break;case n.Left:this.dx=-this.speed}this.sprites=[],this.state=new P(0)}playerCollisionCallback(){this.Game.Player.takeDamage(this.damage)}enemiesCollisionCallback(e){e.takeDamage(this.damage)}deleteCallback(){}}class T extends N{constructor(e,l,a,i,s,d){super(i,s),t(this,"sprite"),this.Game=e,this.x=l,this.y=a,this.width=24,this.height=30,this.damage=d,this.sprite=B.load("/sprites/png/fireball.png"),this.sprites[n.Up]=this.sprite,this.sprites[n.Down]=this.sprite,this.sprites[n.Right]=this.sprite,this.sprites[n.Left]=this.sprite,this.hasPlayerCollision=!0,this.canBeShieldBlocked=!0,this.hasEnemiesCollision=!1}}class j extends N{constructor(e,t,l,a,i,s){super(a,i),this.Game=e,this.x=t,this.y=l,this.width=n.isVertical(i)?20:64,this.height=n.isVertical(i)?64:20,this.damage=s,this.sprites[n.Up]=B.load("/sprites/png/arrow-up.png"),this.sprites[n.Down]=B.load("/sprites/png/arrow-down.png"),this.sprites[n.Right]=B.load("/sprites/png/arrow-right.png"),this.sprites[n.Left]=B.load("/sprites/png/arrow-left.png"),this.hasPlayerCollision=!0,this.canBeShieldBlocked=!0,this.hasEnemiesCollision=!1}}class z extends N{constructor(e,t,l,a,i,s){super(a,i),this.Game=e,this.x=t,this.y=l,this.width=n.isVertical(i)?28:64,this.height=n.isVertical(i)?64:28,this.damage=s,this.sprites=this.Game.Sword.sprites,this.hasPlayerCollision=!1,this.canBeShieldBlocked=!1,this.hasEnemiesCollision=!0}deleteCallback(){this.Game.Sword.isFlying=!1}}(w=o||(o={}))[w.Moving=0]="Moving",w[w.ChangeDirection=1]="ChangeDirection",w[w.Wait=2]="Wait",w[w.Attack=3]="Attack",w[w.Killed=4]="Killed";class K extends M{constructor(){super(),t(this,"Game"),t(this,"hp"),t(this,"speed"),t(this,"damage"),t(this,"isKilledAnimationFinished"),t(this,"hasPlayerCollision"),t(this,"hasViewportCollision"),t(this,"hasBricksCollisions"),t(this,"requirePassBetweenBoxHelper"),t(this,"spritesAnimation"),t(this,"killedSprites",[]),t(this,"invincibleObserver"),t(this,"invincibleDuration"),t(this,"invincibleAnimation"),t(this,"state"),t(this,"dieSound"),t(this,"hitSound"),this.hasPlayerCollision=!0,this.hasViewportCollision=!0,this.hasBricksCollisions=!0,this.requirePassBetweenBoxHelper=!1,this.isKilledAnimationFinished=!1,this.killedSprites[1]=B.load("/sprites/png/killed1.png"),this.killedSprites[2]=B.load("/sprites/png/killed2.png"),this.invincibleObserver=new P(!1),this.invincibleDuration=25,this.invincibleAnimation=new I(7,2),this.dieSound=R.load("/sounds/effect/Enemy_Die.wav"),this.hitSound=R.load("/sounds/effect/Enemy_Hit.wav")}aiThinking(){}move(){this.y+=this.dy,this.x+=this.dx,this.dx=0,this.dy=0}draw(){}playerCollision(){this.Game.Player.takeDamage(this.damage)}viewportCollision(){}bricksCollision(){}customCollision(){}moveHelper(){return!1}takeDamage(e){if(!this.invincibleObserver.is(!0)&&!this.state.is(4)){if(this.hp-=e,this.hp<=0)return this.dieSound.play(),void this.state.setNextState(4);this.getInvicibility(),this.hitSound.play()}}getInvicibility(){this.invincibleObserver.setNextState(!0)}dropItem(){return!!(this.Game.Player.hp<this.Game.Player.maxHp&&s.getOneInt(3))&&(this.Game.ItemManager.addItem(new F(this.Game,this.x+this.width/2-12,this.y+this.height/2-12)),!0)}}class q extends K{constructor(e,l){super(),t(this,"hasChangedDirection"),t(this,"sprites",[]),t(this,"halfHitBoxes"),this.width=e,this.height=l,this.state=new P(1),this.halfHitBoxes=new A(this.hitBox),this.requirePassBetweenBoxHelper=!0}aiThinking(){switch(this.state.get()){case 0:if(this.invincibleObserver.is(!1))switch(this.direction){case n.Down:this.dy=this.speed*this.Game.dt;break;case n.Up:this.dy=-this.speed*this.Game.dt;break;case n.Right:this.dx=this.speed*this.Game.dt;break;case n.Left:this.dx=-this.speed*this.Game.dt}this.state.currentFrame>50&&(s.getOneInt(25)?this.changeDirection():s.getOneInt(25)&&this.state.setNextState(3));break;case 1:this.state.currentFrame>=15&&!this.hasChangedDirection&&(this.direction=n.getRandom(),this.hasChangedDirection=!0),this.state.currentFrame>30&&this.state.setNextState(0);break;case 3:this.state.isFirstFrame&&this.attack(),this.state.currentFrame>30&&this.state.setNextState(0)}}viewportCollision(){this.changeDirection()}bricksCollision(){this.changeDirection()}moveHelper(){return h.passBetweenBoxesHelper(this)}changeDirection(){this.state.setNextState(1),this.hasChangedDirection=!1}draw(){this.Game.Viewport.currentScene.drawImage(this.sprites[this.direction][this.spritesAnimation.currentAnimationStep],this.x,this.y,this.width,this.height)}attack(){}}class Y extends q{constructor(e,t,l,a,i){super(64,64),this.Game=e,this.x=t,this.y=l,this.speed=a,this.direction=i,this.damage=1,this.hp=1,this.sprites[n.Up]=[],this.sprites[n.Up][1]=B.load("/sprites/png/octorok-up1.png"),this.sprites[n.Up][2]=B.load("/sprites/png/octorok-up2.png"),this.sprites[n.Down]=[],this.sprites[n.Down][1]=B.load("/sprites/png/octorok-down1.png"),this.sprites[n.Down][2]=B.load("/sprites/png/octorok-down2.png"),this.sprites[n.Right]=[],this.sprites[n.Right][1]=B.load("/sprites/png/octorok-right1.png"),this.sprites[n.Right][2]=B.load("/sprites/png/octorok-right2.png"),this.sprites[n.Left]=[],this.sprites[n.Left][1]=B.load("/sprites/png/octorok-left1.png"),this.sprites[n.Left][2]=B.load("/sprites/png/octorok-left2.png"),this.spritesAnimation=new I(20/a,2)}attack(){this.Game.ProjectileManager.addProjectile(new T(this.Game,this.x+this.width/2-12,this.y+this.height/2-15,8,this.direction,this.damage))}}class X extends Y{constructor(e,t,l,a,i){super(e,t,l,a,i),this.damage=2,this.hp=2,this.sprites[n.Up]=[],this.sprites[n.Up][1]=B.load("/sprites/png/blue-octorok-up1.png"),this.sprites[n.Up][2]=B.load("/sprites/png/blue-octorok-up2.png"),this.sprites[n.Down]=[],this.sprites[n.Down][1]=B.load("/sprites/png/blue-octorok-down1.png"),this.sprites[n.Down][2]=B.load("/sprites/png/blue-octorok-down2.png"),this.sprites[n.Right]=[],this.sprites[n.Right][1]=B.load("/sprites/png/blue-octorok-right1.png"),this.sprites[n.Right][2]=B.load("/sprites/png/blue-octorok-right2.png"),this.sprites[n.Left]=[],this.sprites[n.Left][1]=B.load("/sprites/png/blue-octorok-left1.png"),this.sprites[n.Left][2]=B.load("/sprites/png/blue-octorok-left2.png")}dropItem(){return!!super.dropItem()||!(!s.getOneInt(3)||this.Game.Player.invincibleObserver.is(!0))&&(this.Game.ItemManager.addItem(new V(this.Game,this.x+this.width/2-16,this.y+this.height/2-16)),!0)}}class Q extends q{constructor(e,l,a,i,s){super(64,64),t(this,"arrowSprites"),this.Game=e,this.x=l,this.y=a,this.width=64,this.height=64,this.speed=i,this.direction=s,this.damage=1,this.hp=1,this.sprites[n.Up]=[],this.sprites[n.Up][1]=B.load("/sprites/png/moblin-up1.png"),this.sprites[n.Up][2]=B.load("/sprites/png/moblin-up2.png"),this.sprites[n.Down]=[],this.sprites[n.Down][1]=B.load("/sprites/png/moblin-down1.png"),this.sprites[n.Down][2]=B.load("/sprites/png/moblin-down2.png"),this.sprites[n.Right]=[],this.sprites[n.Right][1]=B.load("/sprites/png/moblin-right1.png"),this.sprites[n.Right][2]=B.load("/sprites/png/moblin-right2.png"),this.sprites[n.Left]=[],this.sprites[n.Left][1]=B.load("/sprites/png/moblin-left1.png"),this.sprites[n.Left][2]=B.load("/sprites/png/moblin-left2.png"),this.spritesAnimation=new I(25/i,2)}attack(){this.Game.ProjectileManager.addProjectile(new j(this.Game,this.x+this.width/2-12,this.y+this.height/2-15,8,this.direction,this.damage))}}class J extends Q{constructor(e,t,l,a,i){super(e,t,l,a,i),this.damage=2,this.hp=2,this.sprites[n.Up]=[],this.sprites[n.Up][1]=B.load("/sprites/png/blue-moblin-up1.png"),this.sprites[n.Up][2]=B.load("/sprites/png/blue-moblin-up2.png"),this.sprites[n.Down]=[],this.sprites[n.Down][1]=B.load("/sprites/png/blue-moblin-down1.png"),this.sprites[n.Down][2]=B.load("/sprites/png/blue-moblin-down2.png"),this.sprites[n.Right]=[],this.sprites[n.Right][1]=B.load("/sprites/png/blue-moblin-right1.png"),this.sprites[n.Right][2]=B.load("/sprites/png/blue-moblin-right2.png"),this.sprites[n.Left]=[],this.sprites[n.Left][1]=B.load("/sprites/png/blue-moblin-left1.png"),this.sprites[n.Left][2]=B.load("/sprites/png/blue-moblin-left2.png")}dropItem(){return!!super.dropItem()||!(!s.getOneInt(3)||this.Game.Player.invincibleObserver.is(!0))&&(this.Game.ItemManager.addItem(new V(this.Game,this.x+this.width/2-16,this.y+this.height/2-16)),!0)}}class Z extends K{constructor(e,l,a){super(),t(this,"sprites"),t(this,"speedX"),t(this,"speedY"),this.Game=e,this.x=l,this.y=a,this.width=64,this.height=64,this.speed=6,this.direction=n.Down,this.damage=1,this.hp=1,this.hasViewportCollision=!1,this.hasBricksCollisions=!1,this.sprites=[],this.sprites[1]=B.load("/sprites/png/tektite1.png"),this.sprites[2]=B.load("/sprites/png/tektite2.png"),this.spritesAnimation=new I(20,2),this.state=new P(2)}aiThinking(){switch(this.state.get()){case 0:this.state.isFirstFrame?(this.dy=-6,this.dx=this.dy/2*(s.getOneInt(2)?-1:1)):this.dy=this.dy+.1*this.Game.dt,(this.state.currentFrame>60&&s.getOneInt(50)||this.state.currentFrame>100)&&this.state.setNextState(2);break;case 2:this.dx=0,this.dy=0,(this.state.currentFrame>30&&s.getOneInt(50)||this.state.currentFrame>60)&&this.state.setNextState(0)}}customCollision(){h.movingBoxLine(this.hitBox,0,n.Up)&&(this.dy=this.dy/2),h.movingBoxLine(this.hitBox,this.Game.Viewport.height,n.Down)&&this.state.setNextState(2),h.simpleMovingBoxLine(this.hitBox,0,n.Left)&&(this.dx=-this.dx),h.simpleMovingBoxLine(this.hitBox,this.Game.Viewport.width,n.Right)&&(this.dx=-this.dx)}move(){this.state.is(4)||(this.y+=this.dy*this.Game.dt,this.x+=this.dx*this.Game.dt)}draw(){let e;switch(this.state.get()){case 0:e=this.sprites[1];break;case 2:e=this.sprites[this.spritesAnimation.currentAnimationStep]}this.Game.Viewport.currentScene.drawImage(e,this.x,this.y,this.width,this.height)}}class $ extends Z{constructor(e,t,l){super(e,t,l),this.damage=2,this.sprites=[],this.sprites[1]=B.load("/sprites/png/blue-tektite1.png"),this.sprites[2]=B.load("/sprites/png/blue-tektite2.png")}dropItem(){return!!super.dropItem()||!(!s.getOneInt(3)||this.Game.Player.invincibleObserver.is(!0))&&(this.Game.ItemManager.addItem(new V(this.Game,this.x+this.width/2-16,this.y+this.height/2-16)),!0)}}class ee extends W{constructor(e,l,a,i){super(),t(this,"brick"),this.x=e,this.y=l,this.width=a,this.height=a,this.brick=i}}class te extends W{constructor(e,l,a,i,s,n,d){super(),t(this,"Game"),t(this,"Scene"),t(this,"targetWorldIndex"),t(this,"targetSceneC"),t(this,"targetSceneR"),this.Game=e,this.Scene=l,this.x=a*this.Scene.cellSize,this.y=i*this.Scene.cellSize,this.width=this.Scene.cellSize,this.height=this.Scene.cellSize,this.targetWorldIndex=s,this.targetSceneC=n,this.targetSceneR=d}}class le{constructor(e,l,a,i,s,n,d){t(this,"Game"),t(this,"World"),t(this,"cells",[]),t(this,"x"),t(this,"y"),t(this,"c"),t(this,"r"),t(this,"nbRow"),t(this,"nbCol"),t(this,"cellSize"),t(this,"enemies"),t(this,"passages"),t(this,"permanentItems"),t(this,"music"),t(this,"defaultBrick"),t(this,"defaultWallBrick"),t(this,"backgroundColor"),this.Game=e,this.World=l,this.nbRow=11,this.nbCol=16,this.cellSize=64,this.enemies=[],this.passages=[],this.permanentItems=[],this.x=0,this.y=0,this.c=a,this.r=i,this.music=s,this.backgroundColor=d;for(let t=0;t<this.nbCol;t++){this.cells[t]=[];for(let e=0;e<this.nbRow;e++)this.cells[t][e]=new ee(this.cellSize*t,this.cellSize*e,this.cellSize,n)}}get width(){return this.cellSize*this.nbCol}get height(){return this.cellSize*this.nbRow}get hasEnemies(){return this.enemies.length>0}get hasPermanentItems(){return this.permanentItems.length>0}getCell(e,t){return this.cells[e][t]}loadBricks(e){e.forEach(((e,t)=>{e.forEach(((e,l)=>{this.cells[l][t].brick=this.Game.BrickCollection.get(e)}))}))}drawImage(e,t,l,a,i){this.Game.Viewport.drawImage(e,t+this.x,l+this.y,a,i)}fillRect(e,t,l,a,i){this.Game.Viewport.fillRect(e+this.x,t+this.y,l,a,i)}upperEdgeCollision(){this.Game.Viewport.slideScene(n.Up)}rightEdgeCollision(){this.Game.Viewport.slideScene(n.Right)}bottomEdgeCollision(){this.Game.Viewport.slideScene(n.Down)}leftEdgeCollision(){this.Game.Viewport.slideScene(n.Left)}}class ae{constructor(e,l,a,i,s,n){t(this,"Game"),t(this,"scenes",[]),t(this,"nbCol"),t(this,"nbRow"),this.Game=e,this.nbCol=l,this.nbRow=a;for(let t=0;t<this.nbCol;t++){this.scenes[t]=[];for(let e=0;e<this.nbRow;e++)this.scenes[t][e]=new le(this.Game,this,t,e,i,s,n)}}loopScenes(e){this.scenes.forEach((t=>{t.forEach((t=>{e(t)}))}))}}class ie{constructor(e){t(this,"Game"),t(this,"worlds"),t(this,"spawnWorldIndex"),t(this,"spawnSceneColl"),t(this,"spawnSceneRow"),t(this,"spawnCellColl"),t(this,"spawnCellRow"),this.Game=e,this.spawnWorldIndex=0,this.spawnSceneColl=1,this.spawnSceneRow=2,this.spawnCellColl=7,this.spawnCellRow=5.5,this.worlds=[],this.worlds[0]=new ae(this.Game,3,3,R.load("/sounds/music/overworld.mp3",!0),this.Game.BrickCollection.get("default"),"#ffd4aa"),this.worlds[0].scenes[0][0].loadBricks([["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["white-wall","white-wall-br","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","default","default","grave","default","default","grave","default","default","grave","default","default","grave","default","default","default"],["white-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","default","default","grave","default","default","grave","default","default","grave","default","default","grave","default","default","default"],["white-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","default","default","grave","default","default","grave","default","default","default","default","default","grave","default","default","default"],["white-wall","white-wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","white-wall","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","stairs","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","stairs","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"]]),this.worlds[0].scenes[0][0].backgroundColor="#747474",this.worlds[0].scenes[0][0].music=R.load("/sounds/music/death_mountain.mp3",!0),this.worlds[0].scenes[0][0].enemies=[new X(this.Game,128,128,4,s.getOneInt(2)?n.Right:n.Down),new X(this.Game,320,320,4,s.getOneInt(2)?n.Up:n.Down),new X(this.Game,832,192,4,s.getOneInt(2)?n.Up:n.Down)],this.worlds[0].scenes[1][0].loadBricks([["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["default","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","default"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["default","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","default"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["default","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","white-tree","default","default","default"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["white-wall","white-wall","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"]]),this.worlds[0].scenes[1][0].backgroundColor="#747474",this.worlds[0].scenes[1][0].music=R.load("/sounds/music/death_mountain.mp3",!0),this.worlds[0].scenes[1][0].enemies=[new J(this.Game,320,512,4,n.Up),new J(this.Game,512,256,4,s.getOneInt(2)?n.Right:n.Left),new J(this.Game,640,128,4,n.Down)],this.worlds[0].scenes[2][0].loadBricks([["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","passage","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","white-wall-bl","white-wall","white-wall"],["default","default","default","monument-tl","monument-tr","default","default","white-tree","default","default","monument-tl","monument-tr","default","default","white-wall","white-wall"],["default","default","default","monument-bl","monument-br","default","default","default","default","default","monument-bl","monument-br","default","default","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","white-wall","white-wall"],["default","default","default","default","default","default","grave","default","grave","default","default","default","default","default","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","white-wall","white-wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","white-wall-tl","white-wall","white-wall"],["white-wall","white-wall","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall-t","white-wall","white-wall","white-wall"],["white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall","white-wall"]]),this.worlds[0].scenes[2][0].backgroundColor="#747474",this.worlds[0].scenes[2][0].music=R.load("/sounds/music/death_mountain.mp3",!0),this.worlds[0].scenes[2][0].passages=[new te(this.Game,this.worlds[0].scenes[2][0],7,1,2,1,1)],this.worlds[0].scenes[2][0].enemies=[new X(this.Game,320,256,4,n.Down),new X(this.Game,576,384,4,n.Right),new X(this.Game,768,192,4,n.Down),new $(this.Game,448,448)],this.worlds[0].scenes[0][1].loadBricks([["wall","wall","wall","wall","wall","wall","wall","wall","wall","stairs","wall","wall","wall","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","stairs","wall","wall","wall","wall","wall","wall"],["wall","wall-br","default","default","default","default","default","default","default","default","default","default","default","default","wall-bl","wall"],["wall","default","default","single-red-wall","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default","default","default","default","wall-bl"],["wall","default","default","default","default","default","default","default","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default"],["wall","default","default","single-red-wall","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default","default","default","default","default"],["wall","default","default","default","default","default","default","default","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default"],["wall","default","default","single-red-wall","single-red-wall","single-red-wall","single-red-wall","default","default","default","default","default","default","default","default","wall-tl"],["wall","wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","wall-tl","wall"],["wall","wall","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-tr","default","default","wall-tl","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","default","default","wall","wall","wall"]]),this.worlds[0].scenes[0][1].enemies=[new Y(this.Game,384,256,3,s.getOneInt(2)?n.Right:n.Left),new Y(this.Game,256,384,3,s.getOneInt(2)?n.Right:n.Left),new Y(this.Game,448,128,3,s.getOneInt(2)?n.Up:n.Down),new Y(this.Game,832,128,3,n.Down)],this.worlds[0].scenes[1][1].loadBricks([["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall-br","default","default","default","default","default","default","wall-bl","wall-br","default","default","default","default","wall-bl","wall"],["wall-br","default","default","single-wall","default","single-wall","default","default","default","default","default","default","single-wall","default","default","wall-bl"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["default","default","default","single-wall","default","single-wall","default","default","default","default","default","default","single-wall","default","default","default"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["wall-tr","default","default","single-wall","default","single-wall","default","default","default","default","default","default","single-wall","default","default","wall-tl"],["wall","wall-tr","default","default","default","default","default","default","wall-tl","wall-tr","default","default","default","default","wall-tl","wall"],["wall","wall","wall-t","wall-t","wall-t","wall-t","default","default","wall","wall","wall-t","wall-t","wall-t","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","default","default","wall","wall","wall","wall","wall","wall","wall","wall"]]),this.worlds[0].scenes[1][1].enemies=[new Y(this.Game,256,320,3,s.getOneInt(2)?n.Up:n.Down),new Y(this.Game,640,192,3,s.getOneInt(2)?n.Up:n.Down),new Y(this.Game,832,448,3,s.getOneInt(2)?n.Up:n.Down),new Y(this.Game,768,384,3,s.getOneInt(2)?n.Right:n.Left)],this.worlds[0].scenes[2][1].loadBricks([["wall","wall","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree"],["wall","wall","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree"],["wall","wall-br","default","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall-br","default","default","default","default","default","default","tree","default","default","default","tree","default","tree","default","tree"],["default","default","tree","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["default","default","default","default","tree","default","default","tree","default","tree","default","tree","default","tree","default","tree"],["default","default","tree","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall-tr","default","default","default","default","default","default","tree","default","default","default","tree","default","tree","default","tree"],["wall","wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall","wall","tree","default","tree","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall","wall","tree","default","tree","default","tree","default","default","tree","default","tree","default","tree","default","tree"]]),this.worlds[0].scenes[2][1].enemies=[new Y(this.Game,192,256,3,s.getOneInt(2)?n.Right:n.Left),new Y(this.Game,320,384,3,s.getOneInt(2)?n.Right:n.Left),new Y(this.Game,640,320,3,s.getOneInt(2)?n.Up:n.Down),new Y(this.Game,896,128,3,s.getOneInt(2)?n.Left:n.Down)],this.worlds[0].scenes[0][2].loadBricks([["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","default","default","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall-br","default","default","wall","wall","wall"],["wall","wall-br","default","default","default","default","default","default","default","default","default","default","default","wall","wall","wall"],["wall","default","default","default","default","default","default","single-wall","default","default","default","default","default","wall-bl","wall","wall"],["wall","default","default","default","default","default","default","default","default","single-wall","default","default","default","default","wall-bl","wall"],["wall","default","default","default","single-wall","default","default","single-wall","default","default","default","default","default","default","default","default"],["wall","default","default","default","default","default","default","default","default","single-wall","default","default","default","default","wall-tl","wall-t"],["wall","wall-tr","default","default","default","default","default","single-wall","default","default","default","default","default","wall-tl","wall","wall"],["wall","wall","default","default","default","default","default","default","default","default","default","default","default","wall","wall","wall"],["wall","wall","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"]]),this.worlds[0].scenes[0][2].enemies=[new Z(this.Game,192,256),new Z(this.Game,320,448),new Z(this.Game,640,320)],this.worlds[0].scenes[1][2].loadBricks([["wall","wall","wall","wall","wall","wall","default","default","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall","wall","passage","wall","wall-br","default","default","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall","wall-br","default","default","default","default","default","wall","wall","wall","wall","wall","wall","wall","wall"],["wall","wall-br","default","default","default","default","default","default","wall-bl","wall","wall","wall","wall","wall","wall","wall"],["wall-br","default","default","default","default","default","default","default","default","wall-bl","wall","wall","wall","wall","wall","wall"],["default","default","default","default","default","default","default","default","default","default","default","default","default","default","default","default"],["wall-t","default","default","default","default","default","default","default","default","default","default","default","default","default","wall-tl","wall-t"],["wall","wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","wall","wall"],["wall","wall","wall-tr","default","default","default","default","default","default","default","default","default","default","wall-tl","wall","wall"],["wall","wall","wall","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall-t","wall","wall","wall"],["wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall","wall"]]),this.worlds[0].scenes[1][2].passages=[new te(this.Game,this.worlds[0].scenes[1][2],3,1,1,0,0)],this.worlds[0].scenes[2][2].loadBricks([["wall","wall","tree","default","tree","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall","wall","tree","default","tree","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall","wall","default","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall","wall-br","default","default","default","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall-br","default","tree","default","tree","default","default","default","default","default","default","default","default","default","default","tree"],["default","default","default","default","default","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall-t","default","tree","default","tree","default","default","default","default","default","default","default","default","default","default","tree"],["wall","default","default","default","default","default","tree","default","default","tree","default","tree","default","tree","default","tree"],["wall","wall-tr","default","default","default","default","default","default","default","default","default","default","default","default","default","tree"],["wall","wall","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree"],["wall","wall","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree","tree"]]),this.worlds[0].scenes[2][2].enemies=[new Q(this.Game,192,320,3,s.getOneInt(2)?n.Up:n.Down),new Q(this.Game,320,448,3,s.getOneInt(2)?n.Up:n.Down),new Q(this.Game,640,320,3,s.getOneInt(2)?n.Up:n.Down),new Q(this.Game,768,448,3,s.getOneInt(2)?n.Up:n.Down)],this.worlds[1]=new ae(this.Game,1,1,R.load("/sounds/music/death_mountain.mp3",!0),this.Game.BrickCollection.get("default"),"#0f0e0b"),this.worlds[1].scenes[0][0].loadBricks([["red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","fire","default","default","default","default","default","default","default","default","fire","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","default","default","default","default","default","default","default","default","default","default","default","default","default","default","red-wall"],["red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","default","default","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall","red-wall"]]),this.worlds[1].scenes[0][0].permanentItems=[new U(this.Game,498,320)],this.worlds[1].scenes[0][0].bottomEdgeCollision=function(){this.Game.Viewport.changeWorld(!1,0,1,2,3,1)},this.worlds[2]=new ae(this.Game,2,2,R.load("/sounds/music/dungeon.mp3",!0),this.Game.BrickCollection.get("default-dungeon"),"#078382"),this.worlds[2].scenes[0][0].loadBricks([["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"]]),this.worlds[2].scenes[0][0].enemies=[new X(this.Game,128,128,4,s.getOneInt(2)?n.Right:n.Down),new X(this.Game,320,320,4,s.getOneInt(2)?n.Up:n.Down),new X(this.Game,832,192,4,s.getOneInt(2)?n.Up:n.Down),new X(this.Game,512,384,4,s.getOneInt(2)?n.Up:n.Down)],this.worlds[2].scenes[1][0].loadBricks([["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"]]),this.worlds[2].scenes[1][0].permanentItems=[new _(this.Game,499,320)],this.worlds[2].scenes[0][1].loadBricks([["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"]]),this.worlds[2].scenes[0][1].enemies=[new $(this.Game,128,128),new $(this.Game,320,320),new $(this.Game,832,192),new $(this.Game,512,384)],this.worlds[2].scenes[1][1].loadBricks([["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","default-dungeon","wall-dungeon"],["wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","default-dungeon","default-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon","wall-dungeon"]]),this.worlds[2].scenes[1][1].bottomEdgeCollision=function(){this.Game.Viewport.changeWorld(!1,0,2,0,7,1)},this.worlds[2].scenes[1][1].enemies=[new J(this.Game,128,128,4,s.getOneInt(2)?n.Right:n.Down),new J(this.Game,320,320,4,s.getOneInt(2)?n.Up:n.Down),new J(this.Game,832,192,4,s.getOneInt(2)?n.Up:n.Down)]}getSpawnWorld(){return this.worlds[this.spawnWorldIndex]}getSpawnScene(){return this.worlds[this.spawnWorldIndex].scenes[this.spawnSceneColl][this.spawnSceneRow]}loopWorlds(e){this.worlds.forEach((t=>{e(t)}))}}class se{constructor(e){t(this,"Game"),t(this,"enemies",[]),this.Game=e,this.Game.Viewport.currentScene.hasEnemies&&(this.enemies=this.Game.Viewport.currentScene.enemies)}loopEnemies(e){this.enemies.forEach((t=>{e(t)}))}aiThinking(){this.loopEnemies((e=>{e.aiThinking()}))}collisions(){this.loopEnemies((e=>{e.hasPlayerCollision&&h.movingBoxs(this.Game.Player.hitBox,e.hitBox)&&!e.state.is(o.Killed)&&e.playerCollision();let t=e.moveHelper();e.hasBricksCollisions&&this.Game.Viewport.loopCollision((l=>{h.movingBox(e.hitBox,l)&&(t||e.bricksCollision())})),e.customCollision(),e.hasViewportCollision&&h.movingBoxCanvas(e.hitBox,this.Game.Viewport)&&e.viewportCollision()}))}move(){this.loopEnemies((e=>{e.move()}))}draw(){this.loopEnemies((e=>{e.state.is(o.Killed)?e.state.currentFrame<=10?this.Game.Viewport.currentScene.drawImage(e.killedSprites[1],e.x,e.y,e.width,e.height):e.state.currentFrame<=20?this.Game.Viewport.currentScene.drawImage(e.killedSprites[2],e.x,e.y,e.width,e.height):e.isKilledAnimationFinished=!0:(e.invincibleObserver.is(!0)?(e.invincibleAnimation.update(this.Game.dt),1===e.invincibleAnimation.currentAnimationStep&&e.draw()):e.draw(),this.Game.state.is(k.Run)&&e.spritesAnimation.update(this.Game.dt))}))}removeKilled(e=!1){this.loopEnemies((t=>{if(t.isKilledAnimationFinished||e&&t.state.is(o.Killed)){const e=this.enemies.indexOf(t);e>-1&&this.enemies.splice(e,1),this.Game.EnemyManager.enemies.length<=0&&this.Game.Player.increaseScore(),t.dropItem()}}))}updateObservers(){this.loopEnemies((e=>{e.state.update(this.Game.dt),e.invincibleObserver.update(this.Game.dt),e.invincibleObserver.get()&&e.invincibleObserver.currentFrame>e.invincibleDuration&&e.invincibleObserver.setNextState(!1)}))}}class ne{constructor(e){t(this,"Game"),t(this,"currentWorld"),t(this,"nextWorld"),t(this,"currentScene"),t(this,"nextScene"),t(this,"slideSceneDirection"),t(this,"targetCellR"),t(this,"targetCellC"),t(this,"changeWorldFromPassage"),t(this,"changeWorldToPassage"),t(this,"justReachOutPassage"),t(this,"x"),t(this,"y"),t(this,"slideSceneAnimationSpeed"),t(this,"music"),this.Game=e,this.currentWorld=this.Game.Map.getSpawnWorld(),this.nextWorld=null,this.currentScene=this.Game.Map.getSpawnScene(),this.nextScene=null,this.justReachOutPassage=!1,this.music=this.currentScene.music,this.x=0,this.y=0,this.slideSceneAnimationSpeed=10}get cellSize(){return this.currentScene.cellSize}get nbRow(){return this.currentScene.nbRow}get nbCol(){return this.currentScene.nbCol}get width(){return this.currentScene.cellSize*this.currentScene.nbCol}get height(){return this.currentScene.cellSize*this.currentScene.nbRow}loopCells(e,t=this.currentScene){for(let l=0;l<this.nbCol;l++)for(let a=0;a<this.nbRow;a++)e(t.getCell(l,a),l,a)}loopCollision(e){this.loopCells(((t,l,a)=>{t.brick.hasCollisions&&e(t,l,a)}))}draw(){this.Game.state.is(k.Run)&&this.Game.state.isFirstFrame&&this.music.play(),this.currentScene.fillRect(0,0,this.currentScene.width,this.currentScene.height,this.currentScene.backgroundColor),this.loopCells(((e,t,l)=>{this.currentScene.drawImage(e.brick.sprite,this.cellSize*t,this.cellSize*l,this.cellSize,this.cellSize)})),null!==this.nextScene&&(this.nextScene.fillRect(0,0,this.nextScene.width,this.nextScene.height,this.nextScene.backgroundColor),this.loopCells(((e,t,l)=>{this.nextScene.drawImage(e.brick.sprite,this.cellSize*t,this.cellSize*l,this.cellSize,this.cellSize)}),this.nextScene))}collisions(){h.passBetweenBoxesHelper(this.Game.Player),this.loopCollision((e=>{h.movingBox(this.Game.Player.hitBox,e)})),this.Game.Player.knockBackObserver.is(!0)||(this.currentScene.passages.forEach((e=>{h.simpleMovingBox(this.Game.Player.hitBox,e)?this.justReachOutPassage||this.changeWorld(!0,e.targetWorldIndex,e.targetSceneC,e.targetSceneR):this.justReachOutPassage&&(this.justReachOutPassage=!1)})),h.movingBoxLine(this.Game.Player,0,n.Up)?this.currentScene.upperEdgeCollision():h.movingBoxLine(this.Game.Player,this.Game.Viewport.height,n.Down)?this.currentScene.bottomEdgeCollision():h.movingBoxLine(this.Game.Player,0,n.Left)?this.currentScene.leftEdgeCollision():h.movingBoxLine(this.Game.Player,this.Game.Viewport.width,n.Right)&&this.currentScene.rightEdgeCollision())}slideScene(e){this.slideSceneDirection=e;let t=this.currentScene.c,l=this.currentScene.r,a=0,i=0;switch(e){case n.Left:a=-1;break;case n.Right:a=1;break;case n.Up:i=-1;break;case n.Down:i=1}if(!(t+a<0||t+a>this.currentWorld.nbCol-1||l+i<0||l+i>this.currentWorld.nbRow-1)){switch(this.nextScene=this.currentWorld.scenes[t+a][l+i],e){case n.Left:this.nextScene.x=-this.width,this.nextScene.y=0;break;case n.Right:this.nextScene.x=this.width,this.nextScene.y=0;break;case n.Up:this.nextScene.y=-this.height,this.nextScene.x=0;break;case n.Down:this.nextScene.y=this.height,this.nextScene.x=0}this.Game.Player.dx=0,this.Game.Player.dy=0,this.Game.Player.attackObserver.setNextState(!1),this.Game.useCustomLoop((()=>this.slideSceneLoop()))}}slideSceneMove(){let e=this.slideSceneAnimationSpeed*this.Game.dt;switch(this.slideSceneDirection){case n.Left:this.currentScene.x+=e,this.nextScene.x+=e;break;case n.Right:this.currentScene.x-=e,this.nextScene.x-=e;break;case n.Up:this.currentScene.y+=e,this.nextScene.y+=e;break;case n.Down:this.currentScene.y-=e,this.nextScene.y-=e}(this.nextScene.y<=0&&this.slideSceneDirection===n.Down||this.nextScene.y>=0&&this.slideSceneDirection===n.Up||this.nextScene.x<=0&&this.slideSceneDirection===n.Right||this.nextScene.x>=0&&this.slideSceneDirection===n.Left)&&(this.nextScene.y=0,this.nextScene.x=0,this.music.src!==this.nextScene.music.src&&(this.music.pause(),this.music.currentTime=0,this.music=this.nextScene.music,this.music.play()),this.currentScene.permanentItems=this.Game.ItemManager.permanentItems,this.currentScene=this.nextScene,this.nextScene=null,this.Game.EnemyManager.removeKilled(!0),this.Game.EnemyManager=new se(this.Game),this.Game.ProjectileManager.deleteAllProjectiles(),this.Game.ItemManager.deleteAllItems(),this.Game.ItemManager.permanentItems=this.currentScene.permanentItems,this.Game.state.setNextState(k.Run))}slideScenePlayerMove(){switch(this.slideSceneDirection){case n.Left:this.Game.Player.dx=this.slideSceneAnimationSpeed*this.Game.dt;break;case n.Right:this.Game.Player.dx=-this.slideSceneAnimationSpeed*this.Game.dt;break;case n.Up:this.Game.Player.dy=this.slideSceneAnimationSpeed*this.Game.dt;break;case n.Down:this.Game.Player.dy=-this.slideSceneAnimationSpeed*this.Game.dt}h.movingBoxCanvas(this.Game.Player,this),this.Game.Player.move()}slideSceneLoop(){this.slideSceneMove(),this.slideScenePlayerMove(),this.Game.drawGame()}changeWorld(e,t,l,a,i=null,s=null){this.changeWorldFromPassage=e,this.changeWorldToPassage=null!==i&&null!==s,this.targetCellC=i,this.targetCellR=s,this.nextWorld=this.Game.Map.worlds[t],this.nextScene=this.nextWorld.scenes[l][a],this.music.pause(),this.music.currentTime=0,this.music=this.nextScene.music,this.music.play(),this.currentScene.permanentItems=this.Game.ItemManager.permanentItems,this.currentWorld=this.nextWorld,this.currentScene=this.nextScene,this.nextWorld=null,this.nextScene=null,this.Game.EnemyManager.removeKilled(!0),this.Game.EnemyManager=new se(this.Game),this.Game.ProjectileManager.deleteAllProjectiles(),this.Game.ItemManager.deleteAllItems(),this.Game.ItemManager.permanentItems=this.currentScene.permanentItems,this.changeWorldToPassage?(this.Game.Player.x=this.targetCellC*this.currentScene.cellSize,this.Game.Player.y=this.targetCellR*this.currentScene.cellSize,this.targetCellC=0,this.targetCellR=0,this.justReachOutPassage=!0):(this.Game.Player.x=this.currentScene.nbCol*this.currentScene.cellSize/2-this.Game.Player.width/2,this.Game.Player.y=(this.currentScene.nbRow-1)*this.currentScene.cellSize)}drawImage(e,t,l,a,i){this.Game.drawImage(e,t+this.x,l+this.y,a,i)}fillRect(e,t,l,a,i){this.Game.fillRect(e+this.x,t+this.y,l,a,i)}}(g=f||(f={}))[g.Visible=0]="Visible",g[g.Hidden=1]="Hidden",g[g.ShowAnimation=2]="ShowAnimation",g[g.HideAnimation=3]="HideAnimation";class de{constructor(e){t(this,"Game"),t(this,"y"),t(this,"width"),t(this,"height"),t(this,"animationSpeed"),t(this,"state"),this.Game=e,this.y=-this.Game.Canvas.height,this.width=this.Game.Canvas.width,this.height=this.Game.Canvas.height,this.animationSpeed=12,this.state=new P(1)}move(){this.state.is(2)?this.y<0?(this.y+=this.Game.dt*this.animationSpeed,this.Game.Viewport.y+=this.Game.dt*this.animationSpeed,this.Game.Hud.y+=this.Game.dt*this.animationSpeed):(this.y=0,this.state.setNextState(0)):this.state.is(3)&&(this.y>-this.height?(this.y-=this.Game.dt*this.animationSpeed,this.Game.Viewport.y-=this.Game.dt*this.animationSpeed,this.Game.Hud.y-=this.Game.dt*this.animationSpeed):(this.y=-this.height,this.Game.Viewport.y=this.Game.Hud.height,this.Game.Hud.y=0,this.state.setNextState(1),this.Game.state.setNextState(k.Run)))}draw(){this.state.isIn(2,3)&&this.Game.drawGame(),this.fillRect(0,0,this.width,this.height,"#000"),this.fillText("Inventory",this.width/2,this.height/3,"#fff","24px","center","middle"),this.fillText("Q",this.width/2-10,this.height/3*2,"#fff","24px","right","middle"),this.Game.Sword.isEnabled?this.drawImage(this.Game.Sword.sprites[n.Up],this.width/2+10,this.height/3*2-this.Game.Sword.swordWidth/2,this.Game.Sword.swordHeight,this.Game.Sword.swordWidth):this.fillRect(this.width/2+10,this.height/3*2-this.Game.Sword.swordWidth/2,this.Game.Sword.swordHeight,this.Game.Sword.swordWidth,"grey"),this.state.update(this.Game.dt)}drawImage(e,t,l,a,i){this.Game.drawImage(e,t,l+this.y,a,i)}fillRect(e,t,l,a,i){this.Game.fillRect(e,t+this.y,l,a,i)}fillText(e,t,l,a,i="16px",s="left",n="alphabetic"){this.Game.fillText(e,t,l+this.y,a,i,s,n)}}class he extends M{constructor(e){super(),t(this,"Game"),t(this,"speed"),t(this,"movingObserver"),t(this,"attackObserver"),t(this,"diedObserver"),t(this,"diedAnimation"),t(this,"hp"),t(this,"maxHp"),t(this,"invincibleObserver"),t(this,"defaultInvincibleDuration"),t(this,"invincibleDuration"),t(this,"invincibleAnimation"),t(this,"knockBackObserver"),t(this,"knockBackSpeed"),t(this,"knockBackDuration"),t(this,"score"),t(this,"targetScore"),t(this,"obtainedItem"),t(this,"sprites",[]),t(this,"spritesAnimation"),t(this,"attackSprites",[]),t(this,"killedSprites",[]),t(this,"winSprite"),t(this,"halfHitBoxes"),t(this,"hurtSound"),t(this,"dieSound"),t(this,"lowHealthSound"),t(this,"fanfareSound"),this.Game=e,this.movingObserver=new P(!1),this.attackObserver=new P(!1),this.diedObserver=new P(!1),this.diedAnimation=new I(8,4),this.invincibleObserver=new P(!1),this.defaultInvincibleDuration=150,this.invincibleDuration=0,this.knockBackObserver=new P(!1),this.knockBackDuration=10,this.knockBackSpeed=15,this.score=0,this.targetScore=0,this.width=64,this.height=64,this.x=0,this.y=0,this.speed=5,this.maxHp=6,this.hp=this.maxHp,this.direction=n.Up,this.hitBox=new E(this,0,this.height/2,this.width,this.height/2),this.halfHitBoxes=new A(this.hitBox),this.sprites[n.Up]=[],this.sprites[n.Up][1]=B.load("/sprites/png/link-up1.png"),this.sprites[n.Up][2]=B.load("/sprites/png/link-up2.png"),this.attackSprites[n.Up]=B.load("/sprites/png/link-up-attack.png"),this.sprites[n.Right]=[],this.sprites[n.Right][1]=B.load("/sprites/png/link-right1.png"),this.sprites[n.Right][2]=B.load("/sprites/png/link-right2.png"),this.attackSprites[n.Right]=B.load("/sprites/png/link-right-attack.png"),this.sprites[n.Down]=[],this.sprites[n.Down][1]=B.load("/sprites/png/link-down1.png"),this.sprites[n.Down][2]=B.load("/sprites/png/link-down2.png"),this.attackSprites[n.Down]=B.load("/sprites/png/link-down-attack.png"),this.sprites[n.Left]=[],this.sprites[n.Left][1]=B.load("/sprites/png/link-left1.png"),this.sprites[n.Left][2]=B.load("/sprites/png/link-left2.png"),this.attackSprites[n.Left]=B.load("/sprites/png/link-left-attack.png"),this.winSprite=B.load("/sprites/png/link-win.png"),this.killedSprites[1]=B.load("/sprites/png/killed1.png"),this.killedSprites[2]=B.load("/sprites/png/killed2.png"),this.spritesAnimation=new I(6,2),this.invincibleAnimation=new I(5,2),this.hurtSound=R.load("/sounds/effect/Link_Hurt.wav"),this.dieSound=R.load("/sounds/effect/Link_Die.wav"),this.lowHealthSound=R.load("/sounds/effect/Low_Health.wav",!0),this.fanfareSound=R.load("/sounds/effect/Fanfare.wav")}get isFullLife(){return this.hp===this.maxHp}draw(){let e=this.attackObserver.get()?this.attackSprites[this.direction]:this.sprites[this.direction][this.spritesAnimation.currentAnimationStep];this.invincibleObserver.get()&&(this.invincibleAnimation.update(this.Game.dt),2===this.invincibleAnimation.currentAnimationStep&&(e=new Image)),this.Game.Viewport.drawImage(e,this.x,this.y,this.width,this.height),this.movingObserver.is(!0)&&!this.Game.state.is(k.Stopped)&&this.spritesAnimation.update(this.Game.dt)}drawWin(){this.Game.Viewport.drawImage(this.winSprite,this.x,this.y,this.width,this.height)}drawGameOver(){if(this.diedObserver.currentFrame<=125){switch(this.diedAnimation.currentAnimationStep){case 1:this.direction=n.Down;break;case 2:this.direction=n.Left;break;case 3:this.direction=n.Up;break;case 4:this.direction=n.Right}this.draw(),this.diedAnimation.update(this.Game.dt)}else this.diedObserver.currentFrame<=135?this.Game.Viewport.currentScene.drawImage(this.killedSprites[1],this.x,this.y,this.width,this.height):this.diedObserver.currentFrame<=145&&this.Game.Viewport.currentScene.drawImage(this.killedSprites[2],this.x,this.y,this.width,this.height);this.diedObserver.update(this.Game.dt)}move(){this.x+=this.dx,this.y+=this.dy,this.dx=0,this.dy=0}collisions(){}listenEvents(){if(this.knockBackObserver.is(!0)){switch(this.movingObserver.setNextState(!1),this.attackObserver.setNextState(!1),this.direction){case n.Up:this.dy=this.knockBackSpeed*this.Game.dt;break;case n.Right:this.dx=-this.knockBackSpeed*this.Game.dt;break;case n.Down:this.dy=-this.knockBackSpeed*this.Game.dt;break;case n.Left:this.dx=this.knockBackSpeed*this.Game.dt}h.movingBoxCanvas(this.hitBox,this.Game.Viewport)}else this.Game.Sword.isEnabled&&this.attackObserver.setNextState(this.Game.EventManager.isAttackPressed),!this.Game.EventManager.isDownPressed&&!this.Game.EventManager.isUpPressed||this.Game.EventManager.isDownPressed&&this.Game.EventManager.isUpPressed?!this.Game.EventManager.isRightPressed&&!this.Game.EventManager.isLeftPressed||this.Game.EventManager.isRightPressed&&this.Game.EventManager.isLeftPressed||(this.Game.EventManager.isRightPressed?(this.attackObserver.is(!1)&&(this.dx=this.speed*this.Game.dt),this.direction=n.Right):this.Game.EventManager.isLeftPressed&&(this.attackObserver.is(!1)&&(this.dx=-this.speed*this.Game.dt),this.direction=n.Left)):this.Game.EventManager.isDownPressed?(this.attackObserver.is(!1)&&(this.dy=this.speed*this.Game.dt),this.direction=n.Down):this.Game.EventManager.isUpPressed&&(this.attackObserver.is(!1)&&(this.dy=-this.speed*this.Game.dt),this.direction=n.Up),this.movingObserver.setNextState(0!=this.dx||0!=this.dy)}increaseScore(){this.score++,this.score>=this.targetScore&&(this.invincibleObserver.setNextState(!1),this.attackObserver.setNextState(!1),this.movingObserver.setNextState(!1),this.Game.Viewport.music.pause(),this.lowHealthSound.pause(),this.fanfareSound.play(),this.Game.state.setNextState(k.Win))}takeDamage(e){this.invincibleObserver.get()||(this.hurtSound.play(),this.takeKnockBack(),this.hp-e>=0?(this.hp-=e,this.getInvicibility()):this.hp=0,this.hp<=0?(this.diedObserver.setNextState(!1),this.invincibleObserver.setNextState(!1),this.movingObserver.setNextState(!1),this.attackObserver.setNextState(!1),this.Game.Viewport.music.pause(),this.lowHealthSound.pause(),this.dieSound.play(),this.Game.state.setNextState(k.GameOver)):this.hp<=2&&this.lowHealthSound.play())}recoverHealth(e=this.maxHp){this.hp+=e,this.hp>this.maxHp&&(this.hp=this.maxHp),this.hp>2&&(this.lowHealthSound.pause(),this.lowHealthSound.currentTime=0)}takeKnockBack(e=this.direction){this.direction=e,this.knockBackObserver.setNextState(!0)}getInvicibility(e=this.defaultInvincibleDuration){this.invincibleDuration=e,this.invincibleObserver.setNextState(!0)}getImportantItem(e){this.obtainedItem=e,this.Game.Viewport.music.pause(),this.Game.Viewport.music.currentTime=0,this.Game.useCustomLoop((()=>this.getImportantItemLoop()))}getImportantItemDraw(){this.Game.Viewport.drawImage(this.winSprite,this.x,this.y,this.width,this.height),this.Game.Viewport.drawImage(this.obtainedItem.sprite,this.x,this.y-this.obtainedItem.height,this.obtainedItem.width,this.obtainedItem.height),this.Game.state.currentFrame>120&&(this.Game.Viewport.music.play(),this.Game.state.setNextState(k.Run))}getImportantItemLoop(){this.Game.drawGameWithoutPlayer(),this.getImportantItemDraw()}updateObservers(){this.movingObserver.update(this.Game.dt),this.attackObserver.update(this.Game.dt),this.invincibleObserver.update(this.Game.dt),this.knockBackObserver.update(this.Game.dt),this.knockBackObserver.is(!0)&&this.knockBackObserver.currentFrame>this.knockBackDuration&&this.knockBackObserver.setNextState(!1),this.invincibleObserver.get()&&this.invincibleObserver.currentFrame>this.invincibleDuration&&this.invincibleObserver.setNextState(!1)}}class ue extends W{constructor(e){super(),t(this,"Game"),t(this,"swordWidth"),t(this,"swordHeight"),t(this,"swordHandleWidth"),t(this,"sprites",[]),t(this,"slashSound"),t(this,"flyingSound"),t(this,"isFlying"),t(this,"isEnabled"),t(this,"damage"),t(this,"hasHit"),this.Game=e,this.swordWidth=64,this.swordHeight=28,this.swordHandleWidth=16,this.sprites[n.Up]=B.load("/sprites/png/sword-up.png"),this.sprites[n.Right]=B.load("/sprites/png/sword-right.png"),this.sprites[n.Down]=B.load("/sprites/png/sword-down.png"),this.sprites[n.Left]=B.load("/sprites/png/sword-left.png"),this.slashSound=R.load("/sounds/effect/Sword_Slash.wav"),this.flyingSound=R.load("/sounds/effect/Sword_Shoot.wav"),this.isFlying=!1,this.isEnabled=!1,this.damage=1,this.hasHit=!1}get direction(){return this.Game.Player.direction}get x(){return this.direction===n.Up||this.direction===n.Down?this.Game.Player.x+(this.Game.Player.width-this.swordHeight)/2:this.direction===n.Left?this.Game.Player.x-this.swordWidth+this.swordHandleWidth:this.Game.Player.x+this.Game.Player.width-this.swordHandleWidth}get y(){return this.direction===n.Up?this.Game.Player.y-this.swordWidth+this.swordHandleWidth:this.direction===n.Down?this.Game.Player.y+this.Game.Player.width-this.swordHandleWidth:(this.direction,n.Left,this.Game.Player.y+(this.Game.Player.height-this.swordHeight)/2)}get width(){return this.direction===n.Up||this.direction===n.Down?this.swordHeight:this.swordWidth}get height(){return this.direction===n.Up||this.direction===n.Down?this.swordWidth:this.swordHeight}draw(){this.isEnabled&&this.Game.Player.attackObserver.get()&&this.Game.Viewport.drawImage(this.sprites[this.direction],this.x,this.y,this.width,this.height)}drawWin(){this.Game.Viewport.drawImage(this.sprites[n.Up],this.Game.Player.x,this.Game.Player.y-this.swordWidth,this.swordHeight,this.swordWidth)}collisions(){this.isEnabled&&this.Game.Player.attackObserver.get()&&this.Game.EnemyManager.loopEnemies((e=>{h.simpleMovingBox(e.hitBox,this)&&(e.takeDamage(this.damage),this.hasHit=!0)}))}listenEvents(){this.isEnabled&&(this.Game.Player.attackObserver.get()&&this.Game.Player.attackObserver.isFirstFrame&&(this.slashSound.play(),this.hasHit=!1),this.isFlying||!this.Game.Player.attackObserver.getLastFrame()||this.Game.Player.attackObserver.get()||this.hasHit||!this.Game.Player.isFullLife||(this.flyingSound.play(),this.isFlying=!0,this.Game.ProjectileManager.addProjectile(new z(this.Game,this.x,this.y,3*this.Game.Player.speed,this.direction,this.damage))))}}class re{constructor(e){t(this,"Game"),t(this,"projectiles"),t(this,"shieldSound"),this.Game=e,this.projectiles=[],this.shieldSound=R.load("/sounds/effect/Shield.wav")}collisions(){this.loopProjectiles((e=>{if(!e.state.is(u.ShieldBlocked)){if(e.hasEnemiesCollision&&this.Game.EnemyManager.loopEnemies((t=>{h.movingBoxs(t,e.hitBox)&&(null!==e.enemiesCollisionCallback&&e.enemiesCollisionCallback(t),this.deleteProjectile(e))})),e.hasPlayerCollision&&h.movingBoxs(this.Game.Player.hitBox,e.hitBox)){if(e.canBeShieldBlocked&&this.Game.Player.movingObserver.is(!1)&&this.Game.Player.attackObserver.is(!1)&&n.areOpposite(this.Game.Player.direction,e.direction))return this.shieldSound.play(),void e.state.setNextState(u.ShieldBlocked);null!==e.playerCollisionCallback&&e.playerCollisionCallback(),this.deleteProjectile(e)}h.movingBoxCanvas(e.hitBox,this.Game.Viewport)&&this.deleteProjectile(e)}}))}move(){this.loopProjectiles((e=>{switch(e.state.get()){case u.Moving:e.x+=e.dx*this.Game.dt,e.y+=e.dy*this.Game.dt;break;case u.ShieldBlocked:n.isVertical(e.direction)?(e.x+=e.dy/2*this.Game.dt,e.y-=e.dy/2*this.Game.dt):(e.x-=e.dx/2*this.Game.dt,e.y+=e.dx/2*this.Game.dt)}}))}draw(){this.loopProjectiles((e=>{this.Game.Viewport.currentScene.drawImage(e.sprites[e.direction],e.x,e.y,e.width,e.height)}))}updateObservers(){this.loopProjectiles((e=>{e.state.update(this.Game.dt),e.state.is(u.ShieldBlocked)&&e.state.currentFrame>20&&this.deleteProjectile(e)}))}addProjectile(e){this.projectiles.push(e)}deleteProjectile(e){null!==e.deleteCallback&&e.deleteCallback(),this.projectiles.splice(this.projectiles.indexOf(e),1)}deleteAllProjectiles(){this.loopProjectiles((e=>{null!==e.deleteCallback&&e.deleteCallback()})),this.projectiles=[]}loopProjectiles(e){this.projectiles.forEach((t=>{e(t)}))}}class oe{constructor(e){t(this,"Game"),t(this,"items"),t(this,"permanentItems"),this.Game=e,this.items=[],this.permanentItems=[]}collisions(){this.loopItems((e=>{(h.simpleMovingBox(this.Game.Player,e)||this.Game.Player.attackObserver.is(!0)&&h.simpleBox(this.Game.Sword,e))&&(e.collisionCallback(),e.collisionSound.play(),this.deleteItem(e))}))}draw(){this.loopItems((e=>{this.Game.Viewport.currentScene.drawImage(e.sprite,e.x,e.y,e.width,e.height)}))}addItem(e){this.items.push(e)}addPermanentItem(e){this.permanentItems.push(e)}deleteItem(e){let t=this.items.indexOf(e),l=this.permanentItems.indexOf(e);t>-1?this.items.splice(t,1):l>-1&&this.permanentItems.splice(l,1)}deleteAllItems(){this.items=[],this.permanentItems=[]}loopItems(e){this.items.forEach((t=>{e(t)})),this.permanentItems.forEach((t=>{e(t)}))}}class we{constructor(e){t(this,"Game"),t(this,"isRightPressed",!1),t(this,"isLeftPressed",!1),t(this,"isUpPressed",!1),t(this,"isDownPressed",!1),t(this,"isAttackPressed",!1),t(this,"isEnterPressed",!1),t(this,"currentAttackFrame",0),t(this,"attackDuration",10),this.Game=e,document.addEventListener("keydown",(e=>this.keyEvent(e,!0))),document.addEventListener("keyup",(e=>this.keyEvent(e,!1))),document.addEventListener("visibilitychange",(()=>this.visibilityEvent()),!1)}keyEvent(e,t){if(e.repeat)e.preventDefault();else{switch(e.key){case"ArrowRight":this.isRightPressed=t;break;case"ArrowLeft":this.isLeftPressed=t;break;case"ArrowUp":this.isUpPressed=t;break;case"ArrowDown":this.isDownPressed=t;break;case"Enter":this.isEnterPressed=t;break;case"q":case"Q":t&&(this.isAttackPressed=!0);break;case"i":case"I":if(!t)return;this.Game.state.isIn(k.Run)&&this.Game.Panes.isAnimationFinished?(this.Game.state.setNextState(k.Inventory),this.Game.Inventory.state.set(f.ShowAnimation)):this.Game.state.isIn(k.Inventory)&&(this.Game.Inventory.state.is(f.Visible)?this.Game.Inventory.state.setNextState(f.HideAnimation):this.Game.Inventory.state.set(this.Game.Inventory.state.is(f.ShowAnimation)?f.HideAnimation:f.ShowAnimation));break;case"w":case"W":this.Game.state.setNextState(k.Win);break;case"p":case"P":if(!t)return;this.Game.state.isIn(k.Run,k.Stopped)&&this.Game.state.setNextState(this.Game.state.is(k.Run)?k.Stopped:k.Run)}e.preventDefault()}}visibilityEvent(){document.hidden&&this.Game.state.is(k.Run)&&(this.Game.state.setNextState(k.Stopped),this.Game.lastTime=null)}newFrame(){if(this.isAttackPressed)return this.currentAttackFrame+=this.Game.dt,void(this.currentAttackFrame>=this.attackDuration&&(this.isAttackPressed=!1));this.currentAttackFrame=0}}class fe{constructor(e){t(this,"Game"),t(this,"x"),t(this,"y"),t(this,"height"),t(this,"width"),t(this,"emptyHeartSprite"),t(this,"halfHeartSprite"),t(this,"fullHeartSprite"),t(this,"currentSceneAnimation"),this.Game=e,this.x=0,this.y=0,this.height=64,this.emptyHeartSprite=B.load("/sprites/png/empty-heart.png"),this.halfHeartSprite=B.load("/sprites/png/half-heart.png"),this.fullHeartSprite=B.load("/sprites/png/full-heart.png"),this.currentSceneAnimation=new I(25,2)}draw(){this.fillRect(0,0,this.width,this.height,"#000"),this.drawHearts(),this.drawMap(),this.drawScore()}drawHearts(){for(let e=1;e<=this.Game.Player.maxHp/2;e++)this.drawImage(this.emptyHeartSprite,24*e+8*e,this.height/2-12,24,24);for(let e=1;e<=this.Game.Player.hp/2;e++)this.drawImage(this.fullHeartSprite,24*e+8*e,this.height/2-12,24,24);this.Game.Player.hp%2==1&&this.drawImage(this.halfHeartSprite,24*(this.Game.Player.hp/2+1)+8*(this.Game.Player.hp/2-1),this.height/2-12,24,24)}drawMap(){let e=(this.height-this.Game.Viewport.currentWorld.nbRow-1)/this.Game.Viewport.currentWorld.nbRow,t=e*this.Game.Viewport.width/this.Game.Viewport.height,l=(this.width-t*this.Game.Viewport.currentWorld.nbCol+this.Game.Viewport.currentWorld.nbCol-1)/2;this.Game.Viewport.currentWorld.loopScenes((a=>{let i="#00a230";a.hasPermanentItems?i="#e2d64a":a.hasEnemies&&(i="#d11c0d"),this.fillRect(l+t*a.c+2*a.c,e*a.r+2*a.r,t,e,i)})),this.Game.state.isIn(k.Run)&&(1===this.currentSceneAnimation.currentAnimationStep&&this.fillRect(l+t*this.Game.Viewport.currentScene.c+2*this.Game.Viewport.currentScene.c,e*this.Game.Viewport.currentScene.r+2*this.Game.Viewport.currentScene.r,t,e,"rgba(0, 0, 0, 0.3)"),this.currentSceneAnimation.update(this.Game.dt))}drawScore(){this.fillText(" SCORE: "+this.Game.Player.score+"/"+this.Game.Player.targetScore,this.width-this.height/2,this.height/2,"#fff","16px","right","middle")}drawImage(e,t,l,a,i){this.Game.drawImage(e,t+this.x,l+this.y,a,i)}fillRect(e,t,l,a,i){this.Game.fillRect(e+this.x,t+this.y,l,a,i)}fillText(e,t,l,a,i="16px",s="left",n="alphabetic"){this.Game.fillText(e,t+this.x,l+this.y,a,i,s,n)}}class ge{constructor(e){t(this,"Game"),t(this,"speed"),t(this,"position"),this.Game=e,this.speed=8,this.position=0}get isAnimationFinished(){return this.position>this.Game.Canvas.width/2}reset(){this.position=0}drawOpen(){this.Game.fillRect(-this.position,0,this.Game.Canvas.width/2,this.Game.Canvas.height,"#000"),this.Game.fillRect(this.Game.Canvas.width/2+this.position,0,this.Game.Canvas.width/2,this.Game.Canvas.height,"#000"),this.position+=this.speed*this.Game.dt}drawClose(){this.Game.fillRect(-this.Game.Canvas.width/2+this.position,0,this.Game.Canvas.width/2,this.Game.Canvas.height,"#000"),this.Game.fillRect(this.Game.Canvas.width-this.position,0,this.Game.Canvas.width/2,this.Game.Canvas.height,"#000"),this.position+=this.speed*this.Game.dt}}class ce{constructor(e,l,a,i,s,n=0){t(this,"Game"),t(this,"title"),t(this,"message"),t(this,"showMessageAfter"),t(this,"backgroundColor"),t(this,"state"),t(this,"messageAnimation"),this.Game=e,this.title=i,this.message=s,this.showMessageAfter=n,this.backgroundColor=a,this.state=l,this.messageAnimation=new I(50,2)}draw(){this.Game.fillRect(0,0,this.Game.Canvas.width,this.Game.Canvas.height,this.backgroundColor),this.Game.fillText(this.title,this.Game.Canvas.width/2,this.Game.Canvas.height/3,"#fff","24px","center","middle"),this.state.currentFrame>this.showMessageAfter&&(1===this.messageAnimation.currentAnimationStep&&this.Game.fillText(this.message,this.Game.Canvas.width/2,this.Game.Canvas.height/3*2,"#fff","16px","center","middle"),this.messageAnimation.update(this.Game.dt))}updateObservers(){this.state.update(this.Game.dt)}}(p=c||(c={}))[p.BlackScreen=0]="BlackScreen";class pe extends ce{constructor(e){super(e,new P(0),"#000","TLOZ-JS GAME","press enter to start",150),t(this,"music"),this.music=R.load("/sounds/music/intro.mp3",!0)}draw(){switch(this.state.get()){case 0:this.state.isFirstFrame&&this.music.play(),super.draw(),this.state.currentFrame>this.showMessageAfter&&this.Game.EventManager.isEnterPressed&&(this.music.pause(),this.Game.state.setNextState(k.Run))}super.updateObservers()}}(x=m||(m={}))[x.PlayerAnimation=0]="PlayerAnimation",x[x.HideGame=1]="HideGame",x[x.BlackScreen=2]="BlackScreen";class me extends ce{constructor(e){super(e,new P(0),"#000","GAME OVER","press enter to retry",150),t(this,"music"),this.music=R.load("/sounds/music/game_over.mp3",!0)}draw(){switch(this.state.get()){case 0:this.Game.Viewport.draw(),this.Game.EnemyManager.draw(),this.Game.Hud.draw(),this.Game.Player.drawGameOver(),this.Game.Player.diedObserver.currentFrame>145&&this.state.setNextState(1);break;case 1:this.state.isFirstFrame&&this.Game.Panes.reset(),this.Game.Viewport.draw(),this.Game.Hud.draw(),this.Game.Panes.drawClose(),this.Game.Panes.isAnimationFinished&&this.state.setNextState(2);break;case 2:this.state.isFirstFrame&&this.music.play(),this.Game.EventManager.isEnterPressed&&(this.music.pause(),this.Game.restart()),super.draw()}super.updateObservers()}}(S=G||(G={}))[S.PlayerAnimation=0]="PlayerAnimation",S[S.HideGame=1]="HideGame",S[S.BlackScreen=2]="BlackScreen";class xe extends ce{constructor(e){super(e,new P(0),"#000","YOU WON","press enter to play again",150),t(this,"music"),t(this,"killedSprites",[]),this.music=R.load("/sounds/music/ending.mp3",!0),this.killedSprites[1]=B.load("/sprites/png/killed1.png"),this.killedSprites[2]=B.load("/sprites/png/killed2.png")}draw(){switch(this.state.get()){case 0:this.Game.Viewport.draw(),this.Game.EnemyManager.draw(),this.Game.Sword.drawWin(),this.Game.Player.drawWin(),this.Game.Hud.draw(),this.state.currentFrame>120&&this.state.setNextState(1);break;case 1:this.state.isFirstFrame&&this.Game.Panes.reset(),this.Game.Viewport.draw(),this.Game.EnemyManager.draw(),this.Game.Sword.drawWin(),this.Game.Player.drawWin(),this.Game.Hud.draw(),this.Game.Panes.drawClose(),this.Game.Panes.isAnimationFinished&&this.state.setNextState(2);break;case 2:this.state.isFirstFrame&&this.music.play(),this.Game.EventManager.isEnterPressed&&(this.music.pause(),this.Game.restart()),super.draw()}super.updateObservers()}}(y=b||(b={}))[y.BlackScreen=0]="BlackScreen";class Ge extends ce{constructor(e){super(e,new P(0),"rgba(0, 0, 0, 0.5)","PAUSE","press p to continue")}draw(){switch(this.state.get()){case 0:super.draw()}super.updateObservers()}}(v=k||(k={}))[v.Splash=0]="Splash",v[v.Run=1]="Run",v[v.Inventory=2]="Inventory",v[v.Stopped=3]="Stopped",v[v.CustomLoop=4]="CustomLoop",v[v.GameOver=5]="GameOver",v[v.Win=6]="Win";class Se{constructor(e){t(this,"Canvas"),t(this,"ctx"),t(this,"lastTime"),t(this,"dt"),t(this,"BrickCollection"),t(this,"Map"),t(this,"Viewport"),t(this,"Player"),t(this,"Sword"),t(this,"EnemyManager"),t(this,"ProjectileManager"),t(this,"ItemManager"),t(this,"EventManager"),t(this,"Hud"),t(this,"Panes"),t(this,"SplashScreen"),t(this,"GameOverScreen"),t(this,"WinScreen"),t(this,"StoppedScreen"),t(this,"Inventory"),t(this,"state"),t(this,"customLoop"),this.Canvas=e,this.ctx=this.Canvas.getContext("2d"),this.init()}init(){this.EventManager=new we(this),this.BrickCollection=new L(this),this.Map=new ie(this),this.Viewport=new ne(this),this.Player=new he(this),this.Sword=new ue(this),this.EnemyManager=new se(this),this.ProjectileManager=new re(this),this.ItemManager=new oe(this),this.Hud=new fe(this),this.Panes=new ge(this),this.SplashScreen=new pe(this),this.GameOverScreen=new me(this),this.WinScreen=new xe(this),this.StoppedScreen=new Ge(this),this.Viewport.y=this.Hud.height,this.Hud.width=this.Viewport.width,this.Canvas.width=this.Viewport.width,this.Canvas.height=this.Viewport.height+this.Hud.height,this.Inventory=new de(this),this.Player.x=this.Viewport.cellSize*this.Map.spawnCellColl,this.Player.y=this.Viewport.cellSize*this.Map.spawnCellRow,this.Map.loopWorlds((e=>{e.loopScenes((e=>{e.hasEnemies&&this.Player.targetScore++}))})),this.state=new P(0),this.lastTime=null,this.dt=null}restart(){this.init(),this.state.setNextState(1)}run(){window.requestAnimationFrame((e=>this.loop(e)))}deltaCalculation(e){null===this.lastTime?this.dt=1:this.dt=(e-this.lastTime)/(1e3/60),this.lastTime=e}loop(e){switch(window.requestAnimationFrame((e=>this.loop(e))),this.deltaCalculation(e),this.ctx.clearRect(0,0,this.Canvas.width,this.Canvas.height),this.state.get()){case 0:this.splashLoop();break;case 1:this.runLoop();break;case 2:this.inventoryLoop();break;case 3:this.stoppedLoop();break;case 5:this.gameOverLoop();break;case 6:this.winLoop();break;case 4:this.customLoop()}this.state.update(this.dt)}runLoop(){if(!this.Panes.isAnimationFinished)return this.drawGame(),void this.Panes.drawOpen();this.Player.listenEvents(),this.Sword.listenEvents(),this.EnemyManager.aiThinking(),this.Sword.collisions(),this.Player.collisions(),this.ItemManager.collisions(),this.EnemyManager.collisions(),this.ProjectileManager.collisions(),this.Viewport.collisions(),this.Player.move(),this.EnemyManager.move(),this.ProjectileManager.move(),this.drawGame(),this.EnemyManager.removeKilled(),this.Player.updateObservers(),this.EnemyManager.updateObservers(),this.ProjectileManager.updateObservers(),this.EventManager.newFrame()}inventoryLoop(){this.Inventory.move(),this.Inventory.draw()}stoppedLoop(){this.drawGame(),this.StoppedScreen.draw()}splashLoop(){this.SplashScreen.draw()}gameOverLoop(){this.GameOverScreen.draw()}useCustomLoop(e){this.state.setNextState(4),this.customLoop=e}winLoop(){console.log("winLoop"),document.dispatchEvent(new Event("win")),this.WinScreen.draw()}drawGame(){this.Viewport.draw(),this.EnemyManager.draw(),this.Sword.draw(),this.ItemManager.draw(),this.ProjectileManager.draw(),this.Player.draw(),this.Hud.draw()}drawGameWithoutPlayer(){this.Viewport.draw(),this.EnemyManager.draw(),this.Sword.draw(),this.ItemManager.draw(),this.ProjectileManager.draw(),this.Hud.draw()}drawImage(e,t,l,a,i){this.ctx.beginPath(),this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(e,t,l,a,i),this.ctx.closePath()}fillRect(e,t,l,a,i){this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.fillRect(e,t,l,a),this.ctx.closePath()}fillText(e,t,l,a,i="16px",s="left",n="alphabetic"){this.ctx.beginPath(),this.ctx.font=i+" NES-font",this.ctx.fillStyle=a,this.ctx.textAlign=s,this.ctx.textBaseline=n,this.ctx.fillText(e,t,l),this.ctx.closePath()}}let be=document.getElementById("startButton"),ye=document.getElementById("canvas");be.addEventListener("click",(()=>{new Se(ye).run(),be.remove()}));
